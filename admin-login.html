<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Admin Login | ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£</title>
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;font-family:"Kanit",sans-serif;transition:all .3s ease;}
body{
  margin:0;display:flex;flex-direction:column;align-items:center;justify-content:center;
  height:100vh;background:var(--bg);color:var(--text);
}
:root{
  --violet:#715aff;
  --bg:#f4f4f7;
  --text:#0d0d12;
  --card:#fff;
}
body.dark{--bg:#0d0d12;--text:#f4f4f7;--card:#1a1a24;}
header{position:absolute;top:0;left:0;width:100%;display:flex;justify-content:space-between;
align-items:center;padding:15px 25px;background:transparent;}
h1{color:var(--violet);font-weight:600;margin:0;}
#toggleMode{background:none;border:none;font-size:22px;cursor:pointer;color:var(--text);}
.card{
  background:var(--card);padding:30px;border-radius:12px;width:350px;
  box-shadow:0 0 15px rgba(0,0,0,.2);text-align:center;
}
input{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;margin:8px 0;font-size:15px;}
input:focus{border-color:var(--violet);outline:none;}
button{cursor:pointer;border:none;font-size:15px;}
.btn{
  background:var(--violet);color:#fff;padding:10px;border-radius:10px;width:100%;
  font-weight:600;margin-top:8px;
}
.btn:hover{opacity:.9;}
.link-btn{background:none;color:var(--violet);text-decoration:none;font-size:14px;cursor:pointer;}
.toast{
  position:fixed;bottom:20px;right:20px;padding:10px 16px;background:#333;color:#fff;
  border-radius:8px;opacity:0;pointer-events:none;transition:opacity .3s;z-index:9999;
}
.toast.show{opacity:1;}
@media(max-width:480px){.card{width:90%;padding:25px;}}
</style>
</head>
<body>
<header>
  <h1>Admin Login</h1>
  <button id="toggleMode">üåô</button>
</header>

<div class="card">
  <h2>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h2>
  <input type="email" id="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö" />
  <input type="password" id="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" />
  <button id="loginBtn" class="btn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</button>
  <button id="forgotBtn" class="link-btn">‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô?</button>
  <button id="backUser" class="link-btn">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</button>
</div>

<div class="toast" id="toast"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, sendPasswordResetEmail, signOut, onAuthStateChanged } 
  from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, getDoc } 
  from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey:"AIzaSyB_7tyj_BAyFzKEYVrZXfQjWCUXGS7VqKY",
  authDomain:"my-todo-list-9d2fa.firebaseapp.com",
  projectId:"my-todo-list-9d2fa",
  storageBucket:"my-todo-list-9d2fa.appspot.com",
  messagingSenderId:"631403892452",
  appId:"1:631403892452:web:66d382bf5f143fc05de6f1"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const toast=document.getElementById("toast");
function showToast(msg,color="#333"){
  toast.textContent=msg;
  toast.style.background=color;
  toast.classList.add("show");
  setTimeout(()=>toast.classList.remove("show"),3000);
}

// üåô/‚òÄÔ∏è ‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏µ
const body=document.body;
const toggle=document.getElementById("toggleMode");
if(localStorage.getItem("theme")==="dark"){body.classList.add("dark");toggle.textContent="‚òÄÔ∏è";}
toggle.onclick=()=>{
  body.classList.toggle("dark");
  toggle.textContent=body.classList.contains("dark")?"‚òÄÔ∏è":"üåô";
  localStorage.setItem("theme",body.classList.contains("dark")?"dark":"light");
};

// üîë ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
const emailInput=document.getElementById("email");
const passInput=document.getElementById("password");
document.getElementById("loginBtn").onclick=async()=>{
  const email=emailInput.value.trim(),pass=passInput.value.trim();
  if(!email||!pass){showToast("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö","crimson");return;}
  try{
    const userCred=await signInWithEmailAndPassword(auth,email,pass);
    const user=userCred.user;
    if(!user.emailVerified){
      await signOut(auth);
      showToast("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö","orange");
      return;
    }
    const docSnap=await getDoc(doc(db,"users",user.uid));
    if(!docSnap.exists()){await signOut(auth);showToast("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•","crimson");return;}
    const role=docSnap.data().role;
    if(role!=="admin"){await signOut(auth);showToast("üö´ ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö","crimson");return;}
    showToast("‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","green");
    setTimeout(()=>window.location.href="admin.html",1200);
  }catch(err){
    console.error(err);
    showToast("‚ùå ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","crimson");
  }
};

// üì© ‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
document.getElementById("forgotBtn").onclick=async()=>{
  const email=emailInput.value.trim();
  if(!email){showToast("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Å‡πà‡∏≠‡∏ô","orange");return;}
  try{
    await sendPasswordResetEmail(auth,email);
    showToast("üì© ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß","green");
  }catch(err){
    showToast("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏î‡πâ","crimson");
  }
};

// üîô ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ User
document.getElementById("backUser").onclick=()=>window.location.href="login.html";

// üîÅ ‡∏ï‡∏£‡∏ß‡∏à session
onAuthStateChanged(auth,async user=>{
  if(user){
    const snap=await getDoc(doc(db,"users",user.uid));
    if(snap.exists()&&snap.data().role==="admin"){
      window.location.href="admin.html";
    }else{
      await signOut(auth);
    }
  }
});
</script>
</body>
</html>
