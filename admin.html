<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard | TodoTask Pro Enterprise</title>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary:#6a4cff;
      --secondary:#8e7dff;
      --bg-dark:#0a0717;
      --bg-light:#f9f8ff;
      --card-dark:#1a1630;
      --card-light:#ffffff;
      --text-dark:#222;
      --text-light:#f2f2f2;
    }

    body {
      font-family:'Sarabun',sans-serif;
      margin:0;
      background:linear-gradient(135deg,#1a1133,#0a0717);
      color:var(--text-light);
      transition:.4s;
      min-height:100vh;
    }
    body.light {
      background:linear-gradient(135deg,#f3f1ff,#fff);
      color:var(--text-dark);
    }

    /* Header */
    .header {
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      padding:20px 0;
      background:rgba(255,255,255,0.05);
      backdrop-filter:blur(10px);
      box-shadow:0 2px 10px rgba(0,0,0,.3);
    }
    body.light .header {background:rgba(255,255,255,0.7);box-shadow:0 2px 10px rgba(0,0,0,.1);}
    .header h2 {margin:0;}
    .back-btn {
      position:absolute;
      left:20px;
      top:50%;
      transform:translateY(-50%);
      background:rgba(255,255,255,0.15);
      border:none;
      border-radius:50%;
      color:white;
      font-size:20px;
      width:45px;
      height:45px;
      cursor:pointer;
      backdrop-filter:blur(10px);
      transition:all .3s;
    }
    .back-btn:hover {transform:translateY(-50%) scale(1.1);}
    body.light .back-btn {color:#2b1f5f;background:rgba(255,255,255,0.6);}

    /* Container */
    .container {
      max-width:1100px;
      margin:40px auto;
      background:rgba(255,255,255,0.08);
      border-radius:15px;
      padding:30px;
      backdrop-filter:blur(12px);
      box-shadow:0 0 20px rgba(120,80,255,0.3);
    }
    body.light .container {
      background:rgba(255,255,255,0.8);
      box-shadow:0 0 15px rgba(0,0,0,0.1);
    }

    .toolbar {
      display:flex;
      justify-content:center;
      flex-wrap:wrap;
      gap:10px;
      margin-bottom:25px;
    }

    button {
      padding:10px 16px;
      border:none;
      border-radius:10px;
      cursor:pointer;
      background:linear-gradient(135deg,#6a4cff,#9b7fff);
      color:white;
      font-weight:600;
      transition:.3s;
    }
    button:hover {transform:scale(1.05);}

    .logout {
      background:#888;
      color:white;
      padding:10px 16px;
      border:none;
      border-radius:8px;
      cursor:pointer;
    }

    table {
      width:100%;
      border-collapse:collapse;
      margin-top:20px;
    }
    th,td {
      padding:12px;
      border-bottom:1px solid rgba(255,255,255,0.2);
      text-align:left;
    }
    th {
      background:linear-gradient(135deg,#6a4cff,#9b7fff);
      color:white;
    }
    body.light th,body.light td {border-color:rgba(0,0,0,0.1);}

    .chart-box {
      background:rgba(255,255,255,0.08);
      border-radius:10px;
      padding:20px;
      margin-top:30px;
      backdrop-filter:blur(8px);
    }
    body.light .chart-box {background:rgba(255,255,255,0.8);}
    canvas {width:100%;max-height:300px;}
  </style>
</head>

<body>
  <div class="header">
    <button class="back-btn" onclick="goBack()">‚¨Ö</button>
    <h2>üëë ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h2>
  </div>

  <div class="container">
    <div class="toolbar">
      <button onclick="openPage('report.html')">üìà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
      <button onclick="openPage('team.html')">üë• ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ó‡∏µ‡∏°</button>
      <button onclick="goTest()">üß™ ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Test System</button>
      <button class="logout" onclick="logout()">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
      <button onclick="toggleTheme()">üåó ‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô</button>
    </div>

    <div class="chart-box">
      <h3>üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</h3>
      <canvas id="overviewChart"></canvas>
    </div>

    <table>
      <thead>
        <tr><th>‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</th><th>‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</th></tr>
      </thead>
      <tbody id="userTable"></tbody>
    </table>
  </div>

  <footer style="text-align:center;color:#888;margin-top:40px;">¬© 2025 TodoTask Pro Enterprise ‚Äî ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";
import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey:"AIzaSyB_7tyj_BAyFzKEYVrZXfQjWCUXGS7VqKY",
  authDomain:"my-todo-list-9d2fa.firebaseapp.com",
  projectId:"my-todo-list-9d2fa",
  storageBucket:"my-todo-list-9d2fa.appspot.com",
  messagingSenderId:"631403892452",
  appId:"1:631403892452:web:66d382bf5f143fc05de6f1"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// üåó Theme
if(localStorage.getItem("theme")==="light")document.body.classList.add("light");
window.toggleTheme=()=>{
  document.body.classList.toggle("light");
  localStorage.setItem("theme",document.body.classList.contains("light")?"light":"dark");
};

// ‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°
window.goBack = () => window.history.back();

// üß≠ ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏∑‡πà‡∏ô
window.openPage = (p) => location.href = p;

// üß™ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤ Test System
window.goTest = async () => {
  const user = auth.currentUser;
  if(!user){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ó‡∏™‡∏£‡∏∞‡∏ö‡∏ö");
    location.href = "index.html";
    return;
  }
  const ref = doc(db, "users", user.uid);
  const snap = await getDoc(ref);
  if(snap.exists()){
    const data = snap.data();
    if(data.role === "admin"){
      location.href = "test.html";
    }else{
      alert("‚ùå ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤ Test System");
    }
  }else{
    alert("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Firestore");
  }
};

// üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
window.logout = async () => {
  await signOut(auth);
  location.href = "index.html";
};

// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
async function loadUsers(){
  const tbody=document.getElementById("userTable");
  tbody.innerHTML="";
  const snap=await getDocs(collection(db,"users"));
  snap.forEach(docSnap=>{
    const u=docSnap.data();
    tbody.insertAdjacentHTML("beforeend",`<tr><td>${u.email}</td><td>${u.role}</td></tr>`);
  });
}

// ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏£‡∏≤‡∏ü‡∏à‡∏≥‡∏•‡∏≠‡∏á
let chart;
function loadOverview(){
  const data=[40,30,20];
  if(chart)chart.destroy();
  chart=new Chart(document.getElementById("overviewChart"),{
    type:"doughnut",
    data:{
      labels:["‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß","‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥","‡∏Ñ‡πâ‡∏≤‡∏á"],
      datasets:[{data,backgroundColor:["#8e7dff","#b19cff","#d2b8ff"]}]
    },
    options:{cutout:"70%",plugins:{legend:{position:"bottom"}}}
  });
}

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
onAuthStateChanged(auth,user=>{
  if(!user){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô");
    location.href="index.html";
  }else{
    loadUsers();
    loadOverview();
  }
});
</script>
</body>
</html>
