<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å | Task Management System</title>
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;font-family:"Kanit",sans-serif;transition:all .3s ease;}
body{
  margin:0;display:flex;flex-direction:column;align-items:center;justify-content:center;
  height:100vh;background:var(--bg);color:var(--text);
}
:root{
  --violet:#715aff;
  --bg:#f4f4f7;
  --text:#0d0d12;
  --card:#fff;
}
body.dark{--bg:#0d0d12;--text:#f4f4f7;--card:#1a1a24;}
header{position:absolute;top:0;left:0;width:100%;display:flex;justify-content:space-between;
align-items:center;padding:15px 25px;background:transparent;}
h1{color:var(--violet);font-weight:600;margin:0;}
#toggleMode{background:none;border:none;font-size:22px;cursor:pointer;color:var(--text);}
.card{
  background:var(--card);padding:30px;border-radius:12px;width:360px;
  box-shadow:0 0 15px rgba(0,0,0,.2);text-align:center;
}
input{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;margin:8px 0;font-size:15px;}
input:focus{border-color:var(--violet);outline:none;}
button{cursor:pointer;border:none;font-size:15px;}
.btn{
  background:var(--violet);color:#fff;padding:10px;border-radius:10px;width:100%;
  font-weight:600;margin-top:8px;
}
.btn:hover{opacity:.9;}
.link-btn{background:none;color:var(--violet);text-decoration:none;font-size:14px;cursor:pointer;}
.toast{
  position:fixed;bottom:20px;right:20px;padding:10px 16px;background:#333;color:#fff;
  border-radius:8px;opacity:0;pointer-events:none;transition:opacity .3s;z-index:9999;
}
.toast.show{opacity:1;}
@media(max-width:480px){.card{width:90%;padding:25px;}}
</style>
</head>
<body>
<header>
  <h1>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h1>
  <button id="toggleMode">üåô</button>
</header>

<div class="card">
  <h2>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà</h2>
  <input type="text" id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
  <input type="email" id="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
  <input type="password" id="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
  <input type="password" id="confirmPassword" placeholder="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
  <button id="registerBtn" class="btn">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
  <button id="backLogin" class="link-btn">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
  <button id="adminLogin" class="link-btn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö ‚Üí</button>
</div>

<div class="toast" id="toast"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { 
  getAuth, createUserWithEmailAndPassword, sendEmailVerification, signOut 
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { 
  getFirestore, doc, setDoc, serverTimestamp 
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey:"AIzaSyB_7tyj_BAyFzKEYVrZXfQjWCUXGS7VqKY",
  authDomain:"my-todo-list-9d2fa.firebaseapp.com",
  projectId:"my-todo-list-9d2fa",
  storageBucket:"my-todo-list-9d2fa.appspot.com",
  messagingSenderId:"631403892452",
  appId:"1:631403892452:web:66d382bf5f143fc05de6f1"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const toast=document.getElementById("toast");
function showToast(msg,color="#333"){
  toast.textContent=msg;
  toast.style.background=color;
  toast.classList.add("show");
  setTimeout(()=>toast.classList.remove("show"),3000);
}

// üåô/‚òÄÔ∏è Dark‚ÄìLight Mode
const body=document.body;
const toggle=document.getElementById("toggleMode");
if(localStorage.getItem("theme")==="dark"){body.classList.add("dark");toggle.textContent="‚òÄÔ∏è";}
toggle.onclick=()=>{
  body.classList.toggle("dark");
  toggle.textContent=body.classList.contains("dark")?"‚òÄÔ∏è":"üåô";
  localStorage.setItem("theme",body.classList.contains("dark")?"dark":"light");
};

// üîë ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
document.getElementById("registerBtn").onclick=async()=>{
  const name=document.getElementById("name").value.trim();
  const email=document.getElementById("email").value.trim();
  const password=document.getElementById("password").value.trim();
  const confirm=document.getElementById("confirmPassword").value.trim();
  
  if(!name||!email||!password||!confirm){
    showToast("‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô","crimson");return;
  }
  if(password!==confirm){
    showToast("‚ö†Ô∏è ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô","orange");return;
  }

  try{
    const userCred=await createUserWithEmailAndPassword(auth,email,password);
    const user=userCred.user;

    await setDoc(doc(db,"users",user.uid),{
      uid:user.uid,
      name:name,
      email:user.email,
      role:"user",
      verified:false,
      createdAt:serverTimestamp()
    });

    await sendEmailVerification(user);
    showToast(`üì© ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÑ‡∏õ‡∏ó‡∏µ‡πà ${email} ‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢`,"green");
    await signOut(auth);
  }catch(err){
    console.error(err);
    if(err.code.includes("email-already")) showToast("‚ùå ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß","crimson");
    else showToast("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á","crimson");
  }
};

// üîô ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
document.getElementById("backLogin").onclick=()=>window.location.href="login.html";
document.getElementById("adminLogin").onclick=()=>window.location.href="admin-login.html";
</script>
</body>
</html>
