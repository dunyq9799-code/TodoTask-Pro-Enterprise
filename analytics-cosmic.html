<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üåå TodoTask Pro ‚Äì Galactic God Mode</title>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{
      --accent:#e0c097;
      --bg-light:#faf8f5;
      --text-dark:#222;
      --text-light:#f5f5f5;
      --card-light:rgba(255,255,255,0.85);
      --card-dark:rgba(20,25,40,0.85);
    }
    body{
      font-family:'Sarabun',sans-serif;
      margin:0;
      background:var(--bg-light);
      color:var(--text-dark);
      transition:background .6s,color .6s;
      overflow-x:hidden;
    }
    body.dark{color:var(--text-light);}
    header{text-align:center;padding:20px;font-size:1.8em;color:var(--accent);font-weight:600;text-shadow:0 0 10px rgba(224,192,151,.5);}
    .container{max-width:1000px;margin:auto;padding:20px;display:flex;flex-direction:column;gap:25px;position:relative;z-index:2;}
    .card{background:var(--card-light);border-radius:18px;padding:20px;box-shadow:0 4px 10px rgba(0,0,0,.1);transition:.5s;}
    body.dark .card{background:var(--card-dark);box-shadow:0 4px 20px rgba(255,255,255,.05);}
    .theme-toggle{position:fixed;top:15px;right:20px;background:var(--accent);border:none;width:50px;height:50px;border-radius:50%;color:#fff;font-size:22px;cursor:pointer;z-index:10;transition:.3s;}
    .theme-toggle:hover{transform:scale(1.1);}
    /* galaxy canvas */
    #galaxyCanvas{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;background:radial-gradient(circle at 30% 50%,#0a0f24,#000);}
    /* meter */
    .meter{position:relative;width:200px;height:200px;margin:20px auto;}
    .meter svg{transform:rotate(-90deg);width:200px;height:200px;}
    .meter circle{fill:none;stroke-width:10;stroke-linecap:round;}
    .meter-bg{stroke:#ccc;}
    .meter-bar{stroke:var(--accent);stroke-dasharray:628;stroke-dashoffset:628;transition:1s;filter:drop-shadow(0 0 6px rgba(224,192,151,.6));}
    .meter-text{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:28px;font-weight:700;color:var(--accent);}
    .energy-bar{height:22px;background:rgba(224,192,151,.2);border-radius:10px;overflow:hidden;margin:10px 0;}
    .energy-fill{height:100%;width:0;background:linear-gradient(90deg,var(--accent),#f3dcb2);transition:width .6s ease;}
    .energy-text{text-align:center;font-weight:600;color:var(--accent);}
    .timeline{display:flex;justify-content:space-between;align-items:center;position:relative;padding:25px 10px;border-top:2px solid rgba(224,192,151,.3);overflow-x:auto;}
    .timeline-day{position:relative;text-align:center;color:var(--accent);min-width:60px;}
    .timeline-dot{width:14px;height:14px;border-radius:50%;background-color:var(--accent);margin:auto;box-shadow:0 0 10px rgba(224,192,151,.7);}
    .timeline-day.done .timeline-dot{background-color:#fff;box-shadow:0 0 15px 4px rgba(224,192,151,.8);}
    .mood-container{position:relative;height:150px;}
    #moodChart{width:100%;}
    canvas{max-width:100%;}
    @media(max-width:768px){header{font-size:1.4em}.container{padding:10px}}
  </style>
</head>
<body>
<canvas id="galaxyCanvas"></canvas>
<button class="theme-toggle" onclick="toggleTheme()">‚òÄÔ∏è</button>
<header>üåå TodoTask Pro ‚Äì Galactic God Mode</header>

<div class="container">
  <div class="card">
    <h2>‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏Ç‡∏≠‡∏á‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£</h2>
    <div class="meter">
      <svg><circle class="meter-bg" cx="100" cy="100" r="95"></circle><circle class="meter-bar" cx="100" cy="100" r="95"></circle></svg>
      <div class="meter-text" id="meterPercent">0%</div>
    </div>
    <p id="summaryText" style="text-align:center;color:var(--accent)">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
  </div>

  <div class="card">
    <h2>‚ö° Energy Level ‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏°</h2>
    <div class="energy-bar"><div class="energy-fill" id="energyFill"></div></div>
    <div class="energy-text" id="energyText">Level 1 ‚Äì 0/100 XP</div>
  </div>

  <div class="card"><h2>‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</h2><canvas id="pieChart"></canvas></div>
  <div class="card"><h2>‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</h2><canvas id="barChart"></canvas></div>
  <div class="card"><h2>üìÖ ‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à (Task Timeline)</h2><div class="timeline" id="taskTimeline"></div></div>
  <div class="card"><h2>üåà ‡∏î‡∏±‡∏ä‡∏ô‡∏µ‡∏û‡∏•‡∏±‡∏á‡∏ó‡∏µ‡∏° (Team Mood Index)</h2><div class="mood-container"><canvas id="moodChart" height="120"></canvas></div></div>
  <div class="card"><h2>üîÆ ‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏´‡∏ô‡πâ‡∏≤</h2><p id="aiPrediction" style="text-align:center;color:var(--accent);font-size:1.2em;font-weight:600;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...</p></div>
</div>

<script type="module">
import{initializeApp}from"https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import{getFirestore,collection,onSnapshot}from"https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";
const firebaseConfig={apiKey:"AIzaSyB_7tyj_BAyFzKEYVrZXfQjWCUXGS7VqKY",authDomain:"my-todo-list-9d2fa.firebaseapp.com",projectId:"my-todo-list-9d2fa",storageBucket:"my-todo-list-9d2fa.appspot.com",messagingSenderId:"631403892452",appId:"1:631403892452:web:66d382bf5f143fc05de6f1"};
const app=initializeApp(firebaseConfig);const db=getFirestore(app);

function toggleTheme(){
  document.body.classList.toggle("dark");
  const isDark=document.body.classList.contains("dark");
  localStorage.setItem("theme",isDark?"dark":"light");
  document.querySelector(".theme-toggle").textContent=isDark?"üåô":"‚òÄÔ∏è";
}
if(localStorage.getItem("theme")==="dark"){document.body.classList.add("dark");document.querySelector(".theme-toggle").textContent="üåô";}

let pieChart,barChart,moodChart,percentNow=0;
onSnapshot(collection(db,"tasks"),snapshot=>{
  const tasks=snapshot.docs.map(d=>d.data());
  const total=tasks.length,done=tasks.filter(t=>t.completed).length;
  const percent=total?Math.round((done/total)*100):0;
  percentNow=percent;
  updateMeter(percent,done,total);
  updateEnergy(done);
  updatePie(tasks);
  updateBar(tasks);
  updateTimeline(tasks);
  updateMoodChart(tasks);
  updateAIInsight(tasks);
});

function updateMeter(percent,done,total){
  const bar=document.querySelector(".meter-bar");
  const offset=628-(628*percent)/100;
  bar.style.strokeDashoffset=offset;
  document.getElementById("meterPercent").textContent=percent+"%";
  document.getElementById("summaryText").textContent=`‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ${done}/${total} ‡∏á‡∏≤‡∏ô`;
}
function updateEnergy(done){
  const xp=done*10;const level=Math.floor(xp/100)+1;const xpIn=xp%100;
  document.getElementById("energyFill").style.width=xpIn+"%";
  document.getElementById("energyText").textContent=`Level ${level} ‚Äì ${xpIn}/100 XP`;
}
function updatePie(tasks){
  const data=tasks.reduce((a,t)=>{a[t.category]=(a[t.category]||0)+1;return a;},{});const ctx=document.getElementById("pieChart");
  if(pieChart)pieChart.destroy();
  pieChart=new Chart(ctx,{type:"pie",data:{labels:Object.keys(data),datasets:[{data:Object.values(data),backgroundColor:["#e0c097","#bfa58a","#9b8065"]}]},options:{plugins:{legend:{position:"bottom"}}}});
}
function updateBar(tasks){
  const today=new Date();const days=[...Array(7)].map((_,i)=>{const d=new Date(today);d.setDate(today.getDate()-(6-i));return d.toISOString().slice(0,10);});
  const data=days.map(day=>tasks.filter(t=>t.completed&&(t.createdAt+"").includes(day)).length);
  const ctx=document.getElementById("barChart");if(barChart)barChart.destroy();
  barChart=new Chart(ctx,{type:"bar",data:{labels:["‡∏à","‡∏≠","‡∏û","‡∏û‡∏§","‡∏®","‡∏™","‡∏≠‡∏≤"],datasets:[{data,backgroundColor:"rgba(224,192,151,0.8)"}]},options:{scales:{y:{beginAtZero:true}}}});
}
function updateTimeline(tasks){
  const el=document.getElementById("taskTimeline");if(!el)return;
  const today=new Date();const days=[...Array(7)].map((_,i)=>{const d=new Date(today);d.setDate(today.getDate()-(6-i));return d;});
  el.innerHTML=days.map(d=>{const ds=d.toISOString().slice(0,10);const done=tasks.filter(t=>t.completed&&(t.createdAt+"").includes(ds)).length;const act=done>0?"done":"";const wk=d.toLocaleDateString("th-TH",{weekday:"short"});return `<div class="timeline-day ${act}"><div class="timeline-dot"></div><small>${wk}</small></div>`;}).join("");
}
function updateMoodChart(tasks){
  const ctx=document.getElementById("moodChart");if(!ctx)return;
  const today=new Date();const days=[...Array(7)].map((_,i)=>{const d=new Date(today);d.setDate(today.getDate()-(6-i));return d.toISOString().slice(0,10);});
  const data=days.map(day=>tasks.filter(t=>t.completed&&(t.createdAt+"").includes(day)).length);
  if(moodChart)moodChart.destroy();
  moodChart=new Chart(ctx,{type:"line",data:{labels:["‡∏à","‡∏≠","‡∏û","‡∏û‡∏§","‡∏®","‡∏™","‡∏≠‡∏≤"],datasets:[{label:"‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡∏°",data,fill:true,tension:.4,backgroundColor:"rgba(224,192,151,0.1)",borderColor:"rgba(224,192,151,0.9)",pointBackgroundColor:"#e0c097",pointRadius:5}]},options:{scales:{y:{beginAtZero:true,ticks:{stepSize:1}}},plugins:{legend:{display:false}}}});
}
function updateAIInsight(tasks){
  const today=new Date();const days=[...Array(7)].map((_,i)=>{const d=new Date(today);d.setDate(today.getDate()-(6-i));return d.toISOString().slice(0,10);});
  const data=days.map(day=>tasks.filter(t=>t.completed&&(t.createdAt+"").includes(day)).length);
  const avg=data.reduce((a,b)=>a+b,0)/7;const trend=data[data.length-1]-data[data.length-2];
  let msg="";
  if(trend>0)msg=`üåü ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô ${trend} ‡∏á‡∏≤‡∏ô ‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô ${Math.round(avg*1.2)} ‡∏á‡∏≤‡∏ô!`;
  else if(trend<0)msg=`‚ö†Ô∏è ‡∏•‡∏î‡∏•‡∏á ${Math.abs(trend)} ‡∏á‡∏≤‡∏ô ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ü‡∏∑‡πâ‡∏ô ${Math.round(avg)} ‡∏á‡∏≤‡∏ô`;
  else msg=`üìà ‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡∏ó‡∏µ‡πà ${Math.round(avg)} ‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å!`;
  document.getElementById("aiPrediction").textContent=msg;
}

/* üåå galaxy animation */
const canvas=document.getElementById("galaxyCanvas"),ctx2=canvas.getContext("2d");
let stars=[];
function resize(){canvas.width=innerWidth;canvas.height=innerHeight;}
window.addEventListener("resize",resize);resize();
for(let i=0;i<200;i++){stars.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*1.8,speed:Math.random()*0.3+0.05});}
function animate(){
  ctx2.clearRect(0,0,canvas.width,canvas.height);
  const intensity=percentNow/100;
  stars.forEach(s=>{
    s.y+=s.speed*(1+intensity*2);
    if(s.y>canvas.height)s.y=0;
    ctx2.beginPath();
    ctx2.arc(s.x,s.y,s.r*(1+intensity),0,Math.PI*2);
    ctx2.fillStyle=`rgba(224,192,151,${0.3+intensity*0.7})`;
    ctx2.fill();
  });
  requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
