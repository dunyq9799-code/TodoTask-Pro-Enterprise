<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Notifications Center | Task Management System</title>
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;font-family:"Kanit",sans-serif;transition:all .3s ease;}
:root{
 --violet:#715aff;
 --bg-light:#f4f4f7;
 --bg-dark:#0d0d12;
 --card-light:#fff;
 --card-dark:#1a1a24;
 --text-light:#0d0d12;
 --text-dark:#f4f4f7;
}
body{margin:0;background:var(--bg-light);color:var(--text-light);}
body.dark{background:var(--bg-dark);color:var(--text-dark);}
header{
 display:flex;justify-content:space-between;align-items:center;
 background:var(--card-light);padding:10px 20px;box-shadow:0 0 8px rgba(0,0,0,.15);
 position:sticky;top:0;z-index:10;
}
body.dark header{background:var(--card-dark);}
header h1{color:var(--violet);margin:0;}
#toggleMode{background:none;border:none;font-size:22px;cursor:pointer;color:inherit;}
#backBtn{background:var(--violet);color:#fff;border:none;padding:8px 16px;border-radius:8px;cursor:pointer;}
#sidebar{
 width:220px;position:fixed;top:60px;bottom:0;left:0;background:var(--card-light);
 box-shadow:2px 0 8px rgba(0,0,0,.1);overflow-y:auto;
}
body.dark #sidebar{background:var(--card-dark);}
#sidebar ul{list-style:none;margin:0;padding:0;}
#sidebar li{padding:15px;cursor:pointer;display:flex;align-items:center;}
#sidebar li:hover{background:rgba(113,90,255,.15);}
#sidebar li.active{background:rgba(113,90,255,.3);}
#sidebar span{margin-left:10px;}
main{margin-left:220px;padding:20px;}
.card{
 background:var(--card-light);padding:20px;border-radius:12px;box-shadow:0 4px 8px rgba(0,0,0,.1);
 margin-bottom:20px;
}
body.dark .card{background:var(--card-dark);}
.notification-card{
 border-left:5px solid var(--violet);padding:15px;margin:10px 0;border-radius:12px;
 background:var(--card-light);box-shadow:0 2px 6px rgba(0,0,0,.1);
}
body.dark .notification-card{background:#1e1e2a;}
.notification-card.unread{border-left-color:#ffcc00;background:rgba(255,230,150,.1);}
.notification-card h4{margin:0;font-size:18px;color:var(--violet);}
.notification-card p{margin:5px 0;}
.notification-card small{opacity:.7;}
button.primary{background:var(--violet);color:#fff;border:none;padding:8px 14px;border-radius:8px;cursor:pointer;margin:5px;}
.toast{position:fixed;bottom:20px;right:20px;background:#333;color:#fff;padding:10px 16px;border-radius:8px;opacity:0;transition:opacity .3s;z-index:9999;}
.toast.show{opacity:1;}
@media(max-width:768px){
 #sidebar{position:fixed;left:-220px;transition:left .3s;}
 #sidebar.open{left:0;}
 main{margin-left:0;}
}
</style>
</head>
<body>
<header>
  <h1>Notifications Center</h1>
  <div>
    <button id="toggleMode">üåô</button>
    <span id="userName" style="margin:0 10px;font-weight:600;"></span>
    <button id="backBtn">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Dashboard</button>
  </div>
</header>

<div id="sidebar">
  <ul>
    <li class="active" data-page="all">üîî<span>‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span></li>
    <li data-page="unread">üì¨<span>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô</span></li>
    <li data-page="history">üïì<span>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</span></li>
    <li data-page="settings">‚öôÔ∏è<span>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</span></li>
  </ul>
</div>

<main>
  <!-- All Notifications -->
  <section id="all" class="page">
    <div class="card">
      <h2>üîî ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
      <div id="allNotifications"></div>
    </div>
  </section>

  <!-- Unread -->
  <section id="unread" class="page" style="display:none;">
    <div class="card">
      <h2>üì¨ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô</h2>
      <button id="markAllRead" class="primary">üëÅÔ∏è ‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</button>
      <div id="unreadNotifications"></div>
    </div>
  </section>

  <!-- History -->
  <section id="history" class="page" style="display:none;">
    <div class="card">
      <h2>üïì ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h2>
      <div id="readNotifications"></div>
    </div>
  </section>

  <!-- Settings -->
  <section id="settings" class="page" style="display:none;">
    <div class="card">
      <h2>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h2>
      <label><input type="checkbox" id="emailNotify"> üì© ‡∏£‡∏±‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</label><br>
      <label><input type="checkbox" id="inAppNotify"> üîî ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</label><br>
      <button id="saveSettings" class="primary">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
      <button id="clearAll" class="primary" style="background:crimson;">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    </div>
  </section>
</main>

<div class="toast" id="toast"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, collection, query, where, orderBy, getDocs, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig={
 apiKey:"AIzaSyB_7tyj_BAyFzKEYVrZXfQjWCUXGS7VqKY",
 authDomain:"my-todo-list-9d2fa.firebaseapp.com",
 projectId:"my-todo-list-9d2fa",
 storageBucket:"my-todo-list-9d2fa.appspot.com",
 messagingSenderId:"631403892452",
 appId:"1:631403892452:web:66d382bf5f143fc05de6f1"
};
const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

const toast=document.getElementById("toast");
function showToast(msg,color="#333"){toast.textContent=msg;toast.style.background=color;toast.classList.add("show");setTimeout(()=>toast.classList.remove("show"),3000);}

// Theme
const body=document.body,toggle=document.getElementById("toggleMode");
if(localStorage.getItem("theme")==="dark"){body.classList.add("dark");toggle.textContent="‚òÄÔ∏è";}
toggle.onclick=()=>{body.classList.toggle("dark");toggle.textContent=body.classList.contains("dark")?"‚òÄÔ∏è":"üåô";localStorage.setItem("theme",body.classList.contains("dark")?"dark":"light");};

// Navigation
document.querySelectorAll("#sidebar li").forEach(li=>{
 li.onclick=()=>{
   document.querySelectorAll("#sidebar li").forEach(x=>x.classList.remove("active"));
   li.classList.add("active");
   document.querySelectorAll(".page").forEach(p=>p.style.display="none");
   document.getElementById(li.dataset.page).style.display="block";
 };
});

// Back
document.getElementById("backBtn").onclick=()=>window.location.href="index.html";

let currentUser=null,userRole="user";

// Load Notifications
onAuthStateChanged(auth,async user=>{
 if(!user){window.location.href="login.html";return;}
 currentUser=user;
 const users=await getDocs(collection(db,"users"));
 users.forEach(u=>{if(u.id===user.uid){userRole=u.data().role||"user";document.getElementById("userName").textContent=u.data().name||user.email;}});
 loadNotifications();
});

async function loadNotifications(){
 let q;
 if(userRole==="super"){q=query(collection(db,"notifications"),orderBy("timestamp","desc"));}
 else{q=query(collection(db,"notifications"),where("userId","==",currentUser.uid),orderBy("timestamp","desc"));}
 const snap=await getDocs(q);
 const allDiv=document.getElementById("allNotifications");
 const unreadDiv=document.getElementById("unreadNotifications");
 const readDiv=document.getElementById("readNotifications");
 allDiv.innerHTML=unreadDiv.innerHTML=readDiv.innerHTML="";
 if(snap.empty){showToast("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô","orange");return;}
 snap.forEach(n=>{
   const d=n.data();
   const card=document.createElement("div");
   card.className="notification-card "+(d.status==="unread"?"unread":"");
   card.innerHTML=`<h4>${getIcon(d.type)} ${d.type.toUpperCase()}</h4>
   <p>${d.message}</p>
   <small>${new Date(d.timestamp?.seconds*1000).toLocaleString()}</small><br>
   <button onclick="markRead('${n.id}')">üëÅÔ∏è ‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</button>
   <button onclick="delNotify('${n.id}')">üóëÔ∏è ‡∏•‡∏ö</button>`;
   allDiv.appendChild(card);
   if(d.status==="unread")unreadDiv.appendChild(card.cloneNode(true));
   else readDiv.appendChild(card.cloneNode(true));
 });
}

function getIcon(type){
 switch(type){
   case "task":return "‚úÖ";
   case "system":return "‚öôÔ∏è";
   case "announcement":return "üì¢";
   case "team":return "üë•";
   default:return "üîî";
 }
}

// Mark read
window.markRead=async(id)=>{
 await updateDoc(doc(db,"notifications",id),{status:"read"});
 showToast("üëÅÔ∏è ‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß","green");
 loadNotifications();
};

// Delete
window.delNotify=async(id)=>{
 if(!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?"))return;
 await deleteDoc(doc(db,"notifications",id));
 showToast("üóëÔ∏è ‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß","crimson");
 loadNotifications();
};

// Mark all read
document.getElementById("markAllRead").onclick=async()=>{
 const q=query(collection(db,"notifications"),where("userId","==",currentUser.uid),where("status","==","unread"));
 const snap=await getDocs(q);
 for(const n of snap.docs){await updateDoc(doc(db,"notifications",n.id),{status:"read"});}
 showToast("‚úÖ ‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß","green");
 loadNotifications();
};

// Save settings
document.getElementById("saveSettings").onclick=()=>{
 const settings={
   email:document.getElementById("emailNotify").checked,
   inApp:document.getElementById("inAppNotify").checked
 };
 localStorage.setItem("notifySettings",JSON.stringify(settings));
 showToast("üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß","green");
};

// Clear all (admin/super)
document.getElementById("clearAll").onclick=async()=>{
 if(userRole==="user"){showToast("‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•","crimson");return;}
 if(!confirm("‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?"))return;
 const snap=await getDocs(collection(db,"notifications"));
 for(const n of snap.docs){await deleteDoc(doc(db,"notifications",n.id));}
 showToast("üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß","green");
 loadNotifications();
};
</script>
</body>
</html>
