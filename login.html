<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ | ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£</title>
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;}
body{
  margin:0;font-family:'Kanit',sans-serif;
  background:linear-gradient(135deg,#715aff,#2b2d42);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  min-height:100vh;transition:0.4s;color:#fff;
}
body.light{background:linear-gradient(135deg,#f4f4f7,#cfd1e1);color:#111;}
header{position:absolute;top:20px;left:20px;right:20px;display:flex;justify-content:space-between;align-items:center;}
h1{margin:0;font-weight:600;}
.mode-toggle{
  background:#715aff;color:#fff;border:none;border-radius:50%;width:40px;height:40px;
  cursor:pointer;font-size:20px;transition:0.3s;
}
.mode-toggle:hover{transform:scale(1.1);}
.login-card{
  background:rgba(255,255,255,0.1);backdrop-filter:blur(8px);
  padding:30px;border-radius:16px;width:90%;max-width:400px;text-align:center;
  box-shadow:0 0 15px rgba(0,0,0,0.2);transition:0.3s;animation:fadeIn 0.8s ease;
}
body.light .login-card{background:#fff;color:#111;}
.login-card input{
  width:100%;padding:10px 12px;margin:8px 0;border-radius:8px;border:1px solid #ccc;
  font-family:inherit;font-size:15px;outline:none;transition:0.3s;
}
.login-card input:focus{border-color:#715aff;box-shadow:0 0 6px #715aff;}
.login-card button{
  width:100%;padding:10px;background:#715aff;color:#fff;border:none;border-radius:12px;
  cursor:pointer;font-size:16px;margin-top:10px;transition:0.3s;
}
.login-card button:hover{background:#5d4de0;box-shadow:0 0 10px rgba(113,90,255,0.6);}
.register-link{font-size:14px;color:#fff;margin-top:10px;cursor:pointer;display:inline-block;}
body.light .register-link{color:#333;}
#toast{
  position:fixed;bottom:24px;right:24px;background:#333;color:#fff;padding:10px 16px;
  border-radius:8px;opacity:0;transform:translateY(20px);transition:0.3s;z-index:2000;
}
#toast.show{opacity:1;transform:translateY(0);}
#toast.error{background:#e74c3c;}
#verify-warning{display:none;color:#f39c12;margin-top:10px;}
#resend-verify{
  display:none;margin-top:10px;background:#715aff;color:#fff;border:none;
  border-radius:10px;padding:8px 14px;cursor:pointer;transition:0.3s;
}
#resend-verify:hover{box-shadow:0 0 8px rgba(113,90,255,0.8);}
@keyframes fadeIn{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
</style>
</head>
<body>
  <header>
    <h1>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h1>
    <button id="modeToggle" class="mode-toggle">üåô</button>
  </header>

  <div class="login-card" id="loginCard">
    <h2>üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
    <input type="email" id="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•" />
    <div style="position:relative;">
      <input type="password" id="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" style="padding-right:35px;" />
      <span id="togglePass" style="position:absolute;right:10px;top:10px;cursor:pointer;color:#715aff;">üëÅÔ∏è</span>
    </div>
    <button id="loginBtn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    <div id="verify-warning">‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</div>
    <button id="resend-verify">‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
    <span class="register-link" id="openRegister">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</span>
    <br><a href="admin-login.html" style="color:#ccc;font-size:13px;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</a>
  </div>

  <div id="toast"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, sendEmailVerification, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyB_7tyj_BAyFzKEYVrZXfQjWCUXGS7VqKY",
  authDomain: "my-todo-list-9d2fa.firebaseapp.com",
  projectId: "my-todo-list-9d2fa",
  storageBucket: "my-todo-list-9d2fa.appspot.com",
  messagingSenderId: "631403892452",
  appId: "1:631403892452:web:66d382bf5f143fc05de6f1"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const emailEl = document.getElementById("email");
const passEl = document.getElementById("password");
const loginBtn = document.getElementById("loginBtn");
const toast = document.getElementById("toast");
const verifyWarning = document.getElementById("verify-warning");
const resendBtn = document.getElementById("resend-verify");
const modeToggle = document.getElementById("modeToggle");

if (localStorage.getItem("theme") === "light") {
  document.body.classList.add("light");
  modeToggle.textContent = "üåô";
}
modeToggle.onclick = () => {
  document.body.classList.toggle("light");
  const light = document.body.classList.contains("light");
  localStorage.setItem("theme", light ? "light" : "dark");
  modeToggle.textContent = light ? "üåô" : "‚òÄÔ∏è";
};

function showToast(msg, type) {
  toast.textContent = msg;
  toast.className = `show ${type || ""}`;
  setTimeout(() => (toast.className = ""), 3500);
}

function disableButton(btn, seconds) {
  const el = document.querySelector(btn);
  el.disabled = true;
  let counter = seconds;
  const originalText = el.textContent;
  const interval = setInterval(() => {
    el.textContent = `‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà... (${counter--}s)`;
    if (counter < 0) {
      clearInterval(interval);
      el.textContent = originalText;
      el.disabled = false;
    }
  }, 1000);
}

document.getElementById("togglePass").onclick = () => {
  passEl.type = passEl.type === "password" ? "text" : "password";
};

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö session
onAuthStateChanged(auth, async (user) => {
  if (user && user.emailVerified) {
    const userDoc = await getDoc(doc(db, "users", user.uid));
    if (userDoc.exists() && userDoc.data().role === "user") {
      window.location.href = "index.html?role=user";
    } else {
      await signOut(auth);
    }
  }
});

// login
loginBtn.onclick = async () => {
  const email = emailEl.value.trim();
  const pass = passEl.value.trim();
  if (!email || !pass) {
    showToast("‚ö†Ô∏è ‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö", "error");
    return;
  }
  try {
    const userCred = await signInWithEmailAndPassword(auth, email, pass);
    const user = userCred.user;
    if (!user.emailVerified) {
      await signOut(auth);
      verifyWarning.style.display = "block";
      resendBtn.style.display = "inline-block";
      showToast("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö", "error");
      return;
    }
    const userDoc = await getDoc(doc(db, "users", user.uid));
    if (!userDoc.exists()) {
      showToast("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ", "error");
      return;
    }
    if (userDoc.data().role !== "user") {
      await signOut(auth);
      showToast("üö´ ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ", "error");
      return;
    }
    showToast("‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    setTimeout(() => (window.location.href = "index.html?role=user"), 1000);
  } catch (e) {
    console.error(e);
    showToast("‚ùå ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á", "error");
  }
};

// resend verification
resendBtn.addEventListener("click", async () => {
  const email = emailEl.value.trim();
  const pass = passEl.value.trim();
  if (!email || !pass) {
    showToast("‚ö†Ô∏è ‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô", "error");
    return;
  }
  try {
    const tempCred = await signInWithEmailAndPassword(auth, email, pass);
    await sendEmailVerification(tempCred.user);
    await signOut(auth);
    showToast("üìß ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢", "success");
    disableButton("#resend-verify", 30);
  } catch (err) {
    console.error(err);
    showToast("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏î‡πâ", "error");
  }
});

document.getElementById("openRegister").onclick = () => (window.location.href = "register.html");
</script>
</body>
</html>
