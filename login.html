<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö | Task Management System</title>
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;font-family:"Kanit",sans-serif;transition:all .3s ease;}
body{
  margin:0;display:flex;flex-direction:column;align-items:center;justify-content:center;
  height:100vh;background:var(--bg);color:var(--text);
}
:root{
  --violet:#715aff;
  --bg:#f4f4f7;
  --text:#0d0d12;
  --card:#fff;
}
body.dark{--bg:#0d0d12;--text:#f4f4f7;--card:#1a1a24;}
header{position:absolute;top:0;left:0;width:100%;display:flex;justify-content:space-between;
align-items:center;padding:15px 25px;}
h1{color:var(--violet);font-weight:600;margin:0;}
#toggleMode{background:none;border:none;font-size:22px;cursor:pointer;color:var(--text);}
.card{
  background:var(--card);padding:30px;border-radius:12px;width:360px;
  box-shadow:0 0 15px rgba(0,0,0,.2);text-align:center;
}
input{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;margin:8px 0;font-size:15px;}
input:focus{border-color:var(--violet);outline:none;}
button{cursor:pointer;border:none;font-size:15px;}
.btn{
  background:var(--violet);color:#fff;padding:10px;border-radius:10px;width:100%;
  font-weight:600;margin-top:8px;
}
.btn:hover{opacity:.9;}
.link-btn{background:none;color:var(--violet);text-decoration:none;font-size:14px;cursor:pointer;}
.toast{
  position:fixed;bottom:20px;right:20px;padding:10px 16px;background:#333;color:#fff;
  border-radius:8px;opacity:0;pointer-events:none;transition:opacity .3s;z-index:9999;
}
.toast.show{opacity:1;}
#verify-warning{display:none;color:#f39c12;margin-top:10px;}
#resend-verify{display:none;margin-top:10px;background:var(--violet);color:#fff;
border:none;padding:6px 12px;border-radius:8px;cursor:pointer;}
@media(max-width:480px){.card{width:90%;padding:25px;}}
</style>
</head>
<body>
<header>
  <h1>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h1>
  <button id="toggleMode">üåô</button>
</header>

<div class="card">
  <h2>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
  <input type="email" id="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
  <input type="password" id="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
  <button id="loginBtn" class="btn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
  <button id="forgotBtn" class="link-btn">‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô?</button>
  <button id="registerBtn" class="link-btn">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà</button>
  <button id="adminLogin" class="link-btn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö ‚Üí</button>

  <div id="verify-warning">‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</div>
  <button id="resend-verify">‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
</div>

<div class="toast" id="toast"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { 
  getAuth, signInWithEmailAndPassword, sendEmailVerification, sendPasswordResetEmail, signOut, onAuthStateChanged 
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey:"AIzaSyB_7tyj_BAyFzKEYVrZXfQjWCUXGS7VqKY",
  authDomain:"my-todo-list-9d2fa.firebaseapp.com",
  projectId:"my-todo-list-9d2fa",
  storageBucket:"my-todo-list-9d2fa.appspot.com",
  messagingSenderId:"631403892452",
  appId:"1:631403892452:web:66d382bf5f143fc05de6f1"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const toast=document.getElementById("toast");
function showToast(msg,color="#333"){
  toast.textContent=msg;
  toast.style.background=color;
  toast.classList.add("show");
  setTimeout(()=>toast.classList.remove("show"),3000);
}

// üåô/‚òÄÔ∏è Dark‚ÄìLight Mode
const body=document.body;
const toggle=document.getElementById("toggleMode");
if(localStorage.getItem("theme")==="dark"){body.classList.add("dark");toggle.textContent="‚òÄÔ∏è";}
toggle.onclick=()=>{
  body.classList.toggle("dark");
  toggle.textContent=body.classList.contains("dark")?"‚òÄÔ∏è":"üåô";
  localStorage.setItem("theme",body.classList.contains("dark")?"dark":"light");
};

// üîë ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
document.getElementById("loginBtn").onclick=async()=>{
  const email=document.getElementById("email").value.trim();
  const password=document.getElementById("password").value.trim();
  if(!email||!password){showToast("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö","orange");return;}
  try{
    const userCred=await signInWithEmailAndPassword(auth,email,password);
    const user=userCred.user;
    if(!user.emailVerified){
      await signOut(auth);
      document.getElementById("verify-warning").style.display="block";
      document.getElementById("resend-verify").style.display="inline-block";
      showToast("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö","orange");
      return;
    }
    const docSnap=await getDoc(doc(db,"users",user.uid));
    if(!docSnap.exists()){await signOut(auth);showToast("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•","crimson");return;}
    const role=docSnap.data().role;
    if(role==="user"){
      showToast("‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","green");
      setTimeout(()=>window.location.href="index.html?role=user",1000);
    }else if(role==="admin"){
      showToast("‚úÖ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö","green");
      setTimeout(()=>window.location.href="admin.html?role=admin",1000);
    }else{
      await signOut(auth);
      showToast("‚ùå ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö","crimson");
    }
  }catch(err){
    console.error(err);
    showToast("‚ùå ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","crimson");
  }
};

// üì© ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
document.getElementById("resend-verify").onclick=async()=>{
  const email=document.getElementById("email").value.trim();
  const password=document.getElementById("password").value.trim();
  if(!email||!password){showToast("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô","orange");return;}
  try{
    const userCred=await signInWithEmailAndPassword(auth,email,password);
    await sendEmailVerification(userCred.user);
    await signOut(auth);
    showToast("üì© ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢","green");
    document.getElementById("resend-verify").disabled=true;
    let sec=30;
    const btn=document.getElementById("resend-verify");
    const interval=setInterval(()=>{
      sec--;
      btn.textContent=`‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà... (${sec}s)`;
      if(sec<=0){clearInterval(interval);btn.textContent="‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á";btn.disabled=false;}
    },1000);
  }catch(err){
    showToast("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏î‡πâ","crimson");
  }
};

// üîê ‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
document.getElementById("forgotBtn").onclick=async()=>{
  const email=document.getElementById("email").value.trim();
  if(!email){showToast("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Å‡πà‡∏≠‡∏ô","orange");return;}
  try{
    await sendPasswordResetEmail(auth,email);
    showToast("üì© ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß","green");
  }catch(err){
    showToast("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ","crimson");
  }
};

// üîó ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏∑‡πà‡∏ô
document.getElementById("registerBtn").onclick=()=>window.location.href="register.html";
document.getElementById("adminLogin").onclick=()=>window.location.href="admin-login.html";

// üß† ‡∏ï‡∏£‡∏ß‡∏à session
onAuthStateChanged(auth,async user=>{
  if(user&&user.emailVerified){
    const snap=await getDoc(doc(db,"users",user.uid));
    if(snap.exists()){
      const role=snap.data().role;
      if(role==="admin") window.location.href="admin.html";
      else window.location.href="index.html";
    }
  }
});
</script>
</body>
</html>
