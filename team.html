<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Team Management | Task Management System</title>
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
*{box-sizing:border-box;font-family:"Kanit",sans-serif;transition:all .3s ease;}
:root{
 --violet:#715aff;
 --bg-light:#f4f4f7;
 --bg-dark:#0d0d12;
 --card-light:#fff;
 --card-dark:#1a1a24;
 --text-light:#0d0d12;
 --text-dark:#f4f4f7;
}
body{margin:0;background:var(--bg-light);color:var(--text-light);}
body.dark{background:var(--bg-dark);color:var(--text-dark);}
header{
 display:flex;justify-content:space-between;align-items:center;
 background:var(--card-light);padding:10px 20px;box-shadow:0 0 8px rgba(0,0,0,.15);
 position:sticky;top:0;z-index:999;
}
body.dark header{background:var(--card-dark);}
header h1{color:var(--violet);margin:0;}
#toggleMode{background:none;border:none;font-size:22px;cursor:pointer;color:inherit;}
#backBtn{background:var(--violet);color:#fff;border:none;padding:8px 16px;border-radius:8px;cursor:pointer;}
#sidebar{
 width:220px;position:fixed;top:60px;bottom:0;left:0;background:var(--card-light);
 box-shadow:2px 0 8px rgba(0,0,0,.1);overflow-y:auto;
}
body.dark #sidebar{background:var(--card-dark);}
#sidebar ul{list-style:none;margin:0;padding:0;}
#sidebar li{padding:15px;cursor:pointer;display:flex;align-items:center;}
#sidebar li:hover{background:rgba(113,90,255,.15);}
#sidebar li.active{background:rgba(113,90,255,.3);}
#sidebar span{margin-left:10px;}
main{margin-left:220px;padding:20px;}
.card{
 background:var(--card-light);padding:20px;border-radius:12px;
 box-shadow:0 4px 8px rgba(0,0,0,.1);margin-bottom:20px;
}
body.dark .card{background:var(--card-dark);}
.flex{display:flex;flex-wrap:wrap;gap:15px;}
button.primary{background:var(--violet);color:#fff;border:none;padding:8px 14px;border-radius:8px;cursor:pointer;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{border:1px solid #ddd;padding:8px;text-align:left;}
th{background:var(--violet);color:#fff;}
.toast{position:fixed;bottom:20px;right:20px;background:#333;color:#fff;padding:10px 16px;border-radius:8px;opacity:0;transition:opacity .3s;z-index:9999;}
.toast.show{opacity:1;}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);display:none;justify-content:center;align-items:center;}
.modal-content{background:var(--card-light);padding:20px;border-radius:12px;max-width:400px;width:90%;}
body.dark .modal-content{background:var(--card-dark);}
</style>
</head>
<body>
<header>
  <h1>Team Management</h1>
  <div>
    <button id="toggleMode">üåô</button>
    <span id="userName" style="margin:0 10px;font-weight:600;"></span>
    <button id="backBtn">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Dashboard</button>
  </div>
</header>

<div id="sidebar">
  <ul>
    <li class="active" data-page="overview">üè†<span>‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏µ‡∏°</span></li>
    <li data-page="allTeams">üë•<span>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°</span></li>
    <li data-page="members">üßë‚Äçü§ù‚Äçüßë<span>‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏ô‡∏ó‡∏µ‡∏°</span></li>
    <li data-page="tasks">üìã<span>‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏°</span></li>
    <li data-page="settings">‚öôÔ∏è<span>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡∏°</span></li>
  </ul>
</div>

<main>
  <section id="overview" class="page">
    <div class="flex">
      <div class="card" style="flex:1;"><h3>‡∏ó‡∏µ‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3><p id="teamCount">0</p></div>
      <div class="card" style="flex:1;"><h3>‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3><p id="memberCount">0</p></div>
      <div class="card" style="flex:1;"><h3>‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3><p id="taskCount">0</p></div>
    </div>
    <div class="card"><canvas id="teamChart"></canvas></div>
  </section>

  <section id="allTeams" class="page" style="display:none;">
    <div class="card">
      <h2>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
      <button id="addTeamBtn" class="primary">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏°‡πÉ‡∏´‡∏°‡πà</button>
      <table id="teamTable">
        <thead><tr><th>‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°</th><th>‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡∏°</th><th>‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <section id="members" class="page" style="display:none;">
    <div class="card">
      <h2>‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏ô‡∏ó‡∏µ‡∏°</h2>
      <button id="addMemberBtn" class="primary">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
      <table id="memberTable">
        <thead><tr><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th><th>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <section id="tasks" class="page" style="display:none;">
    <div class="card">
      <h2>‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏°</h2>
      <button id="addTaskBtn" class="primary">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô</button>
      <table id="taskTable">
        <thead><tr><th>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</th><th>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡πÄ‡∏î‡∏î‡πÑ‡∏•‡∏ô‡πå</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <section id="settings" class="page" style="display:none;">
    <div class="card">
      <h2>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡∏°</h2>
      <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°:</label><input type="text" id="teamName">
      <label>‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡∏°:</label><input type="text" id="teamLead">
      <button id="saveTeam" class="primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á</button>
      <button id="deleteTeam" class="primary" style="background:crimson;">‡∏•‡∏ö‡∏ó‡∏µ‡∏°‡∏ô‡∏µ‡πâ</button>
    </div>
  </section>
</main>

<div id="addTeamModal" class="modal">
  <div class="modal-content">
    <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏°‡πÉ‡∏´‡∏°‡πà</h3>
    <input type="text" id="newTeamName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°">
    <input type="text" id="newTeamLead" placeholder="‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡∏°">
    <button id="saveNewTeam" class="primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    <button id="closeModal" class="primary" style="background:gray;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, collection, getDocs, addDoc, doc, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig={
 apiKey:"AIzaSyB_7tyj_BAyFzKEYVrZXfQjWCUXGS7VqKY",
 authDomain:"my-todo-list-9d2fa.firebaseapp.com",
 projectId:"my-todo-list-9d2fa",
 storageBucket:"my-todo-list-9d2fa.appspot.com",
 messagingSenderId:"631403892452",
 appId:"1:631403892452:web:66d382bf5f143fc05de6f1"
};
const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

const toast=document.getElementById("toast");
function showToast(msg,color="#333"){toast.textContent=msg;toast.style.background=color;toast.classList.add("show");setTimeout(()=>toast.classList.remove("show"),3000);}

// Theme
const body=document.body,toggle=document.getElementById("toggleMode");
if(localStorage.getItem("theme")==="dark"){body.classList.add("dark");toggle.textContent="‚òÄÔ∏è";}
toggle.onclick=()=>{body.classList.toggle("dark");toggle.textContent=body.classList.contains("dark")?"‚òÄÔ∏è":"üåô";localStorage.setItem("theme",body.classList.contains("dark")?"dark":"light");};

// Nav
document.querySelectorAll("#sidebar li[data-page]").forEach(li=>{
 li.onclick=()=>{
   document.querySelectorAll("#sidebar li").forEach(x=>x.classList.remove("active"));
   li.classList.add("active");
   document.querySelectorAll(".page").forEach(p=>p.style.display="none");
   document.getElementById(li.dataset.page).style.display="block";
 };
});

// Auth
let userRole="user";
onAuthStateChanged(auth,async user=>{
 if(!user){window.location.href="login.html";return;}
 const snap=await getDocs(collection(db,"users"));
 snap.forEach(u=>{if(u.id===user.uid){userRole=u.data().role||"user";document.getElementById("userName").textContent=u.data().name||user.email;}});
 loadOverview();loadTeams();
});

// Back
document.getElementById("backBtn").onclick=()=>window.location.href="index.html";

// Overview
async function loadOverview(){
 const teams=await getDocs(collection(db,"teams"));
 const users=await getDocs(collection(db,"users"));
 const tasks=await getDocs(collection(db,"tasks"));
 document.getElementById("teamCount").textContent=teams.size;
 document.getElementById("memberCount").textContent=users.size;
 document.getElementById("taskCount").textContent=tasks.size;
 const labels=[],data=[];
 teams.forEach(t=>{labels.push(t.data().name);const count=tasks.docs.filter(x=>x.data().teamId===t.id).length;data.push(count);});
 new Chart(document.getElementById("teamChart"),{type:"bar",data:{labels:labels,datasets:[{label:"‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡∏°",data:data,backgroundColor:"#715aff"}]},options:{plugins:{legend:{display:false}}}});
}

// All Teams
async function loadTeams(){
 const res=await getDocs(collection(db,"teams"));
 const tbody=document.querySelector("#teamTable tbody");
 tbody.innerHTML="";
 res.forEach(t=>{
   const d=t.data();
   const tr=document.createElement("tr");
   tr.innerHTML=`<td>${d.name}</td><td>${d.lead||"-"}</td><td>${d.members?d.members.length:0}</td><td>${d.createdAt?new Date(d.createdAt.seconds*1000).toLocaleDateString():"-"}</td>
   <td>${userRole!=="user"?`<button onclick="deleteTeam('${t.id}')">üóëÔ∏è</button>`:"-"}</td>`;
   tbody.appendChild(tr);
 });
}
window.deleteTeam=async(id)=>{if(!confirm("‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ó‡∏µ‡∏°‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?"))return;await deleteDoc(doc(db,"teams",id));showToast("üóëÔ∏è ‡∏•‡∏ö‡∏ó‡∏µ‡∏°‡πÅ‡∏•‡πâ‡∏ß","crimson");loadTeams();};

// Add Team
const modal=document.getElementById("addTeamModal");
document.getElementById("addTeamBtn").onclick=()=>{if(userRole==="user"){showToast("‚ùå ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå","crimson");return;}modal.style.display="flex";};
document.getElementById("closeModal").onclick=()=>modal.style.display="none";
document.getElementById("saveNewTeam").onclick=async()=>{
 const name=document.getElementById("newTeamName").value.trim();
 const lead=document.getElementById("newTeamLead").value.trim();
 if(!name||!lead){showToast("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö","orange");return;}
 await addDoc(collection(db,"teams"),{name:name,lead:lead,createdAt:serverTimestamp(),members:[]});
 showToast("‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏°‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","green");
 modal.style.display="none";
 loadTeams();
};
</script>
</body>
</html>
