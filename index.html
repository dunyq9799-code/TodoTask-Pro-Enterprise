<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üìã ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô</title>
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js"></script>

<style>
:root {
  --primary: #715aff;
  --bg-light: #f4f4f7;
  --bg-dark: #0d0d12;
  --card-light: #ffffff;
  --card-dark: #1a1a24;
  --text-light: #222;
  --text-dark: #f4f4f7;
  --warn: #f1c40f;
  --error: #e74c3c;
  --transition: all 0.3s ease;
}
* { box-sizing: border-box; }
body {
  font-family: 'Kanit', sans-serif;
  margin: 0;
  background: var(--bg-light);
  color: var(--text-light);
  transition: var(--transition);
}
body.dark { background: var(--bg-dark); color: var(--text-dark); }

header {
  display: flex; justify-content: space-between; align-items: center;
  padding: 20px 32px;
  background: var(--card-light);
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transition: var(--transition);
  position: relative; z-index: 5;
}
body.dark header { background: var(--card-dark); }
header h1 { color: var(--primary); font-size: 22px; margin: 0; display: flex; align-items: center; gap: 10px; }
.hamburger { font-size: 24px; cursor: pointer; background: none; border: none; color: var(--primary); }
.header-actions { display: flex; align-items: center; gap: 10px; position: relative; }
button { font-family: inherit; border: none; cursor: pointer; border-radius: 8px; padding: 8px 14px; font-size: 15px; transition: var(--transition); }
.mode-toggle { background: var(--primary); color: white; }
.login-btn, .logout-btn { background: #6c63ff; color: white; }

/* üîî Notification */
.notify-icon { font-size: 22px; background: none; border: none; position: relative; transition: transform 0.3s; }
.notify-icon:hover { transform: scale(1.15); }
.dot { position: absolute; top: 4px; right: 4px; width: 8px; height: 8px; background: red; border-radius: 50%; display: none; }
.dot.active { display: block; }
.notify-box {
  position: absolute; top: 38px; right: 0; background: var(--card-light);
  border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  width: 260px; max-height: 250px; overflow-y: auto;
  display: none; z-index: 10; padding: 12px 16px;
}
body.dark .notify-box { background: var(--card-dark); }
.notify-box.active { display: block; }
.notify-item { margin-bottom: 10px; border-left: 4px solid var(--primary); padding-left: 10px; font-size: 14px; }
.notify-item.warn { border-color: var(--warn); }
.notify-item.error { border-color: var(--error); }

/* Sidebar */
.sidebar {
  position: fixed; top: 0; left: -250px; width: 250px; height: 100%;
  background: var(--card-light); box-shadow: 2px 0 10px rgba(0,0,0,0.2);
  padding: 20px; transition: var(--transition); z-index: 3;
}
body.dark .sidebar { background: var(--card-dark); }
.sidebar.active { left: 0; }
.sidebar h2 { color: var(--primary); }
.sidebar a { display: block; margin: 10px 0; color: inherit; text-decoration: none; }
.sidebar a:hover { color: var(--primary); }
.backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); display: none; z-index: 2; }
.backdrop.active { display: block; }

/* MAIN */
main { padding: 24px; display: flex; flex-direction: column; align-items: center; gap: 20px; }
.control-bar { display: flex; flex-wrap: wrap; justify-content: space-between; gap: 12px;
  background: var(--card-light); border-radius: 12px; padding: 12px 24px; width: 100%; max-width: 1200px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1); transition: var(--transition);
}
body.dark .control-bar { background: var(--card-dark); }
.search-box { flex: 1; display: flex; align-items: center; background: #eaeaf0; border-radius: 10px; padding: 6px 12px; }
body.dark .search-box { background: #2a2a35; }
.search-box input { flex: 1; border: none; background: transparent; color: inherit; padding: 8px; outline: none; }
select { border-radius: 8px; padding: 8px 10px; border: 1px solid #ccc; font-family: inherit; transition: var(--transition); }
body.dark select { background: #2a2a35; color: #f4f4f7; border-color: #555; }

.view-toggle { display: flex; gap: 10px; }
.view-toggle button { border: 1px solid var(--primary); background: transparent; color: var(--primary); border-radius: 10px; padding: 8px 14px; transition: var(--transition); }
.view-toggle button.active { background: var(--primary); color: white; }

.board { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; width: 100%; max-width: 1200px; }
.task-card { background: var(--card-light); border-radius: 12px; padding: 18px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: var(--transition); opacity: 0; transform: translateY(10px); animation: fadeIn 0.5s forwards; }
body.dark .task-card { background: var(--card-dark); }
@keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
.task-header { font-weight: 600; color: var(--primary); margin-bottom: 10px; }
.subtasks { list-style: none; padding: 0; margin: 0; }
.subtasks li { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
.subtasks span.done { text-decoration: line-through; color: #999; }
.add-btn { background: var(--primary); color: white; }

#calendar { width: 100%; max-width: 1200px; background: var(--card-light); border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: var(--transition); }
body.dark #calendar { background: var(--card-dark); }

/* Modal */
.modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 4; }
.modal.active { display: flex; }
.modal-content { background: var(--card-light); padding: 24px; border-radius: 12px; width: 90%; max-width: 420px; transition: var(--transition); }
body.dark .modal-content { background: var(--card-dark); }
.modal-content input, .modal-content textarea { width: 100%; padding: 10px; margin-bottom: 12px; border-radius: 8px; border: 1px solid #ccc; font-family: inherit; }
.modal-actions { display: flex; justify-content: flex-end; gap: 10px; }

.toast { position: fixed; bottom: 24px; right: 24px; background: #333; color: #fff; padding: 12px 20px; border-radius: 6px; opacity: 0; transform: translateY(20px); transition: var(--transition); }
.toast.show { opacity: 1; transform: translateY(0); }

@media (max-width: 600px) {
  .board { grid-template-columns: 1fr; }
  .control-bar { flex-direction: column; }
}
</style>
</head>
<body>
<header>
  <div class="left-header">
    <button class="hamburger" id="hamburger">‚ò∞</button>
    <h1>üìã ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô</h1>
  </div>
  <div class="header-actions">
    <button id="loginBtn" class="login-btn">Login</button>
    <button id="logoutBtn" class="logout-btn" style="display:none;">Logout</button>
    <button id="notifyBtn" class="notify-icon">üîî<span class="dot" id="dot"></span></button>
    <div class="notify-box" id="notifyBox"></div>
    <button id="modeToggle" class="mode-toggle">üåô</button>
  </div>
</header>

<aside class="sidebar" id="sidebar">
  <h2>‡πÄ‡∏°‡∏ô‡∏π</h2>
  <p id="userName"></p>
  <a href="report.html">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</a>
  <a href="admin.html">‚öôÔ∏è ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</a>
</aside>
<div class="backdrop" id="backdrop"></div>

<main>
  <div class="view-toggle">
    <button id="boardViewBtn" class="active">üìã ‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏á‡∏≤‡∏ô</button>
    <button id="calendarViewBtn">üìÜ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏á‡∏≤‡∏ô</button>
  </div>

  <div class="control-bar">
    <div class="search-box">üîç<input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏á‡∏≤‡∏ô..."></div>
    <div class="filter-group">
      <select id="statusFilter">
        <option value="all">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
        <option value="done">‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</option>
        <option value="undone">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à</option>
      </select>
      <select id="assigneeFilter"><option value="all">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö: ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option></select>
      <select id="dateFilter">
        <option value="all">‡πÄ‡∏î‡∏ó‡πÑ‡∏•‡∏ô‡πå: ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
        <option value="today">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</option>
        <option value="week">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</option>
        <option value="month">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</option>
      </select>
    </div>
  </div>

  <button id="addTaskBtn" class="add-btn">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
  <div class="board" id="board"></div>
  <div id="calendar" style="display:none;"></div>
  <p id="noResultMsg" style="display:none;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>
</main>

<div class="modal" id="modal">
  <div class="modal-content">
    <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h3>
    <input type="text" id="mainTaskInput" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÉ‡∏´‡∏ç‡πà" />
    <textarea id="subTaskInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏¢‡πà‡∏≠‡∏¢ (‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡πâ‡∏≠)"></textarea>
    <input type="date" id="deadlineInput" />
    <input type="text" id="assigneeInput" placeholder="‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö" />
    <div class="modal-actions">
      <button id="cancelBtn">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      <button id="saveBtn" class="add-btn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    </div>
  </div>
</div>

<div id="toast" class="toast">‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, updateDoc, doc } 
  from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

const firebaseConfig={apiKey:"AIzaSyB_7tyj_BAyFzKEYVrZXfQjWCUXGS7VqKY",authDomain:"my-todo-list-9d2fa.firebaseapp.com",projectId:"my-todo-list-9d2fa",storageBucket:"my-todo-list-9d2fa.appspot.com",messagingSenderId:"631403892452",appId:"1:631403892452:web:66d382bf5f143fc05de6f1"};
const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

/* Dark/Light Mode */
const modeToggle=document.getElementById("modeToggle");
document.body.classList.toggle("dark",localStorage.getItem("mode")==="dark");
modeToggle.textContent=document.body.classList.contains("dark")?"‚òÄÔ∏è":"üåô";
modeToggle.onclick=()=>{document.body.classList.toggle("dark");const m=document.body.classList.contains("dark")?"dark":"light";localStorage.setItem("mode",m);modeToggle.textContent=m==="dark"?"‚òÄÔ∏è":"üåô";};

/* Sidebar */
const sidebar=document.getElementById("sidebar"),backdrop=document.getElementById("backdrop");
document.getElementById("hamburger").onclick=()=>{sidebar.classList.add("active");backdrop.classList.add("active");};
backdrop.onclick=()=>{sidebar.classList.remove("active");backdrop.classList.remove("active");};

/* Login Mock */
const loginBtn=document.getElementById("loginBtn"),logoutBtn=document.getElementById("logoutBtn"),userName=document.getElementById("userName");
function updateLogin(){const u=localStorage.getItem("user");if(u){loginBtn.style.display="none";logoutBtn.style.display="inline-block";userName.textContent="üë§ "+u;}else{loginBtn.style.display="inline-block";logoutBtn.style.display="none";userName.textContent="";}}
loginBtn.onclick=()=>{const n=prompt("‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:");if(n){localStorage.setItem("user",n);updateLogin();}};
logoutBtn.onclick=()=>{localStorage.removeItem("user");updateLogin();};
updateLogin();

/* Modal */
const modal=document.getElementById("modal"),addTaskBtn=document.getElementById("addTaskBtn"),cancelBtn=document.getElementById("cancelBtn"),saveBtn=document.getElementById("saveBtn");
addTaskBtn.onclick=()=>modal.classList.add("active");
cancelBtn.onclick=()=>modal.classList.remove("active");
modal.onclick=e=>{if(e.target===modal)modal.classList.remove("active");};
const toast=document.getElementById("toast");
function showToast(msg){toast.textContent=msg;toast.classList.add("show");setTimeout(()=>toast.classList.remove("show"),3000);}

/* Data render + Calendar */
const board=document.getElementById("board"),calendarEl=document.getElementById("calendar");
let allTasks=[],calendar;
onSnapshot(collection(db,"projects"),(snap)=>{allTasks=snap.docs.map(d=>({...d.data(),id:d.id}));renderBoard();renderCalendar();});

saveBtn.onclick=async()=>{const main=document.getElementById("mainTaskInput").value.trim();
const subs=document.getElementById("subTaskInput").value.split("\n").filter(s=>s.trim()!=="");
const date=document.getElementById("deadlineInput").value;
const who=document.getElementById("assigneeInput").value.trim();
if(!main)return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÉ‡∏´‡∏ç‡πà");
await addDoc(collection(db,"projects"),{main,subs:subs.map(s=>({title:s,done:false})),done:false,deadline:date,assignee:who,createdAt:new Date()});
modal.classList.remove("active");showToast("‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");};

/* View Toggle */
const boardViewBtn=document.getElementById("boardViewBtn"),calendarViewBtn=document.getElementById("calendarViewBtn");
boardViewBtn.onclick=()=>{calendarEl.style.display="none";board.style.display="grid";boardViewBtn.classList.add("active");calendarViewBtn.classList.remove("active");};
calendarViewBtn.onclick=()=>{board.style.display="none";calendarEl.style.display="block";boardViewBtn.classList.remove("active");calendarViewBtn.classList.add("active");renderCalendar();};

/* Render Board */
function renderBoard(){
board.innerHTML="";
allTasks.forEach(t=>{
const card=document.createElement("div");card.className="task-card";
card.innerHTML=`<div class="task-header">${t.main}${t.done?" ‚úÖ":""}</div>
<small>‡πÄ‡∏î‡∏ó‡πÑ‡∏•‡∏ô‡πå: ${t.deadline||"-"}</small><br/><small>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö: ${t.assignee||"-"}</small>
<ul class="subtasks"></ul>`;
const ul=card.querySelector(".subtasks");
t.subs.forEach((s,i)=>{const li=document.createElement("li");
const cb=document.createElement("input");cb.type="checkbox";cb.checked=s.done;
const span=document.createElement("span");span.textContent=s.title;if(s.done)span.classList.add("done");
cb.onchange=async()=>{t.subs[i].done=cb.checked;span.classList.toggle("done",cb.checked);const allDone=t.subs.every(x=>x.done);await updateDoc(doc(db,"projects",t.id),{subs:t.subs,done:allDone});renderCalendar();};
li.append(cb,span);ul.append(li);});
board.append(card);});
new Sortable(board,{animation:150});}

/* Calendar Render */
function renderCalendar(){
if(!calendar){calendar=new FullCalendar.Calendar(calendarEl,{
initialView:window.innerWidth<600?"timeGridWeek":"dayGridMonth",
height:"auto",
editable:true,
eventDrop:async(info)=>{const t=allTasks.find(x=>x.id===info.event.id);
if(t){await updateDoc(doc(db,"projects",t.id),{deadline:info.event.startStr});}},
eventClick:(info)=>{
const t=allTasks.find(x=>x.id===info.event.id);
if(t){alert(`‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠: ${t.main}\n‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö: ${t.assignee||"-"}\n‡πÄ‡∏î‡∏ó‡πÑ‡∏•‡∏ô‡πå: ${t.deadline||"-"}\n‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${t.done?"‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß":"‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à"}`);}},
events:[]});calendar.render();}
const events=allTasks.filter(t=>t.deadline).map(t=>{
const now=new Date(),due=new Date(t.deadline);
let color=varColor(t,now,due);
return {id:t.id,title:t.main,start:t.deadline,color:color};
});
calendar.removeAllEvents();calendar.addEventSource(events);}

function varColor(t,now,due){
if(t.done)return"#999";
if(due<now)return"#e74c3c";
if((due-now)/(1000*60*60*24)<=1)return"#f1c40f";
return"#715aff";
}
</script>
</body>
</html>
