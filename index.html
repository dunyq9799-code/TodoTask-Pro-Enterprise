<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>TodoTask Pro Enterprise</title>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet" />
<style>
:root {
  --accent: #7c5cff;
  --accent-dark: #5a3fe0;
  --bg-dark: #0f0f1a;
  --bg-light: #f5f4fa;
  --card-dark: rgba(40, 40, 60, 0.5);
  --card-light: rgba(255, 255, 255, 0.6);
  --text-light: #eee;
  --text-dark: #222;
}

body {
  font-family: 'Sarabun', sans-serif;
  margin: 0;
  background: var(--bg-light);
  color: var(--text-dark);
  transition: background 0.5s, color 0.5s;
}

body.dark {
  background: var(--bg-dark);
  color: var(--text-light);
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 18px 28px;
  backdrop-filter: blur(12px);
  background: rgba(255,255,255,0.1);
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  position: sticky;
  top: 0;
  z-index: 1000;
}

header h1 {
  font-size: 1.5em;
  font-weight: 600;
  color: var(--accent);
}

.nav-actions {
  display: flex;
  align-items: center;
  gap: 12px;
}

button {
  border: none;
  border-radius: 8px;
  padding: 8px 14px;
  cursor: pointer;
  background: var(--accent);
  color: white;
  font-weight: 500;
  transition: all 0.3s ease;
}

button:hover { background: var(--accent-dark); }

.menu {
  position: relative;
}

.menu-content {
  position: absolute;
  right: 0;
  top: 45px;
  background: var(--card-dark);
  backdrop-filter: blur(12px);
  border-radius: 10px;
  display: none;
  flex-direction: column;
  padding: 10px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.3);
}

.menu-content.show { display: flex; }

.menu-content button {
  margin: 5px 0;
  width: 160px;
  text-align: left;
  background: transparent;
  color: var(--text-light);
  border: 1px solid rgba(255,255,255,0.2);
}

.container {
  max-width: 1000px;
  margin: 40px auto;
  padding: 20px;
  text-align: center;
}

.board {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 15px;
}

.project {
  width: 280px;
  border-radius: 12px;
  padding: 15px;
  backdrop-filter: blur(14px);
  background: var(--card-light);
  color: var(--text-dark);
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  transition: transform 0.2s ease;
}

body.dark .project { background: var(--card-dark); color: var(--text-light); }

.project:hover { transform: scale(1.03); }

.project h3 {
  color: var(--accent);
  margin-top: 0;
}

.subtask { text-align: left; }
.subtask input { margin-right: 8px; }

.deadline {
  font-size: 13px;
  font-weight: 500;
  margin-top: 5px;
}
.deadline.green { color: #4caf50; }
.deadline.orange { color: #ff9800; }
.deadline.red { color: #f44336; }

.fab {
  position: fixed;
  bottom: 25px;
  right: 25px;
  background: var(--accent);
  color: white;
  border-radius: 50%;
  width: 55px;
  height: 55px;
  font-size: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  cursor: pointer;
  transition: 0.3s;
}
.fab:hover { transform: scale(1.1); }

.popup {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  display: none;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(8px);
}

.popup-content {
  background: rgba(255,255,255,0.9);
  backdrop-filter: blur(15px);
  border-radius: 12px;
  padding: 25px;
  text-align: left;
  width: 320px;
  color: var(--text-dark);
}

body.dark .popup-content { background: rgba(30,30,50,0.8); color: var(--text-light); }

.popup-content input, .popup-content textarea {
  width: 100%;
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #ccc;
  margin-bottom: 10px;
}

@media(max-width: 700px) {
  .board { flex-direction: column; align-items: center; }
  .project { width: 90%; }
}
</style>
</head>

<body>
  <header>
    <h1>TodoTask Pro Enterprise</h1>
    <div class="nav-actions">
      <button id="themeBtn">üåô</button>
      <button id="loginBtn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
      <div class="menu">
        <button id="menuToggle">‚ò∞</button>
        <div class="menu-content" id="menuContent">
          <button onclick="location.href='report.html'">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</button>
          <button onclick="location.href='settings.html'">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</button>
          <button onclick="location.href='test.html'">‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <h2>üìã ‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
    <div class="board" id="board"></div>
  </div>

  <div class="fab" id="addBtn">Ôºã</div>

  <!-- popup -->
  <div class="popup" id="popup">
    <div class="popup-content" id="popupContent">
      <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h3>
      <input type="text" id="projectName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå">
      <input type="date" id="deadline">
      <textarea id="subtasks" placeholder="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏¢‡πà‡∏≠‡∏¢ (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà)"></textarea>
      <button onclick="saveProject()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    </div>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, updateDoc, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB_7tyj_BAyFzKEYVrZXfQjWCUXGS7VqKY",
  authDomain: "my-todo-list-9d2fa.firebaseapp.com",
  projectId: "my-todo-list-9d2fa",
  storageBucket: "my-todo-list-9d2fa.appspot.com",
  messagingSenderId: "631403892452",
  appId: "1:631403892452:web:66d382bf5f143fc05de6f1"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const board = document.getElementById("board");
const popup = document.getElementById("popup");
const popupContent = document.getElementById("popupContent");
const addBtn = document.getElementById("addBtn");

let role = "user"; // ‡∏à‡∏≥‡∏•‡∏≠‡∏á ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô "admin" ‡∏à‡∏∞ drag ‡πÑ‡∏î‡πâ

// ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î popup
addBtn.onclick = () => { popup.style.display = "flex"; };
document.addEventListener("click", (e) => {
  if (popup.style.display === "flex" && !popupContent.contains(e.target) && e.target !== addBtn) {
    const name = document.getElementById("projectName").value.trim();
    if (!name) popup.style.display = "none";
  }
});

// ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• realtime
const q = query(collection(db, "projects"), orderBy("created", "asc"));
onSnapshot(q, (snapshot) => {
  board.innerHTML = "";
  snapshot.forEach(docSnap => {
    const p = docSnap.data();
    const projectDiv = document.createElement("div");
    projectDiv.className = "project";
    projectDiv.innerHTML = `
      <h3>${p.title}</h3>
      <div class="subtask">
        ${p.tasks.map((t, i) => `
          <div>
            <input type="checkbox" ${t.done ? "checked" : ""} onchange="toggleSubtask('${docSnap.id}',${i},this.checked)">
            <label>${t.text}</label>
          </div>`).join("")}
      </div>
      <div class="deadline ${deadlineColor(p.deadline)}">‡πÄ‡∏î‡∏î‡πÑ‡∏•‡∏ô‡πå: ${p.deadline}</div>
    `;
    board.appendChild(projectDiv);
  });
});

// deadline color
window.deadlineColor = (date) => {
  if (!date) return "";
  const today = new Date();
  const d = new Date(date);
  const diff = (d - today)/(1000*60*60*24);
  if (diff < 0) return "red";
  if (diff < 3) return "orange";
  return "green";
};

// toggle subtask
window.toggleSubtask = async (id, idx, checked) => {
  const ref = doc(db, "projects", id);
  const snapshot = await (await import("https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js")).getDoc(ref);
  const p = snapshot.data();
  p.tasks[idx].done = checked;
  const allDone = p.tasks.every(t => t.done);
  p.done = allDone;
  await updateDoc(ref, p);
};

// save project
window.saveProject = async () => {
  const title = document.getElementById("projectName").value.trim();
  const deadline = document.getElementById("deadline").value;
  const subtasks = document.getElementById("subtasks").value.split("\n").filter(t=>t.trim());
  if (!title) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå");
  await addDoc(collection(db, "projects"), {
    title,
    tasks: subtasks.map(t=>({text:t, done:false})),
    deadline,
    done:false,
    created: new Date(),
    order: Date.now()
  });
  popup.style.display = "none";
  document.getElementById("projectName").value="";
  document.getElementById("deadline").value="";
  document.getElementById("subtasks").value="";
};

// menu
const menuToggle = document.getElementById("menuToggle");
const menuContent = document.getElementById("menuContent");
menuToggle.onclick = (e) => {
  e.stopPropagation();
  menuContent.classList.toggle("show");
};
document.addEventListener("click", (e) => {
  if (!menuContent.contains(e.target) && e.target !== menuToggle) menuContent.classList.remove("show");
});

// theme
const themeBtn = document.getElementById("themeBtn");
themeBtn.onclick = () => {
  document.body.classList.toggle("dark");
  const dark = document.body.classList.contains("dark");
  themeBtn.textContent = dark ? "‚òÄÔ∏è" : "üåô";
  localStorage.setItem("theme", dark ? "dark" : "light");
};
if (localStorage.getItem("theme")==="dark"){document.body.classList.add("dark");themeBtn.textContent="‚òÄÔ∏è";}
</script>
</body>
</html>
