<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TodoTask Pro Enterprise</title>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg-dark: #0b0b15;
  --bg-light: #f7f7fa;
  --card-dark: rgba(255, 255, 255, 0.08);
  --card-light: #ffffffb0;
  --accent: #7a5af8;
  --accent-glow: rgba(122,90,248,0.4);
  --text-light: #f5f5f5;
  --text-dark: #1b1b1b;
  --blur: blur(12px);
}
body {
  margin: 0; font-family: 'Sarabun', sans-serif;
  background: var(--bg-dark); color: var(--text-light);
  transition: background 0.5s, color 0.5s;
  overflow-x: hidden;
}
header {
  display: flex; justify-content: space-between; align-items: center;
  padding: 20px 40px;
  background: rgba(0,0,0,0.3);
  backdrop-filter: var(--blur);
  position: sticky; top: 0; z-index: 10;
}
header h1 { margin: 0; font-weight: 600; color: var(--accent); }
header .controls button {
  background: rgba(255,255,255,0.15);
  color: var(--text-light);
  border: none; border-radius: 10px;
  margin-left: 8px; padding: 10px 16px;
  cursor: pointer; font-weight: 600;
  transition: 0.3s;
  backdrop-filter: var(--blur);
}
header .controls button:hover {
  background: var(--accent-glow);
}
main {
  padding: 30px;
  max-width: 1200px;
  margin: auto;
}
.dashboard {
  display: flex; flex-wrap: wrap; justify-content: center;
  gap: 20px; margin-bottom: 30px;
}
.card-stat {
  background: var(--card-dark);
  backdrop-filter: var(--blur);
  padding: 20px 30px;
  border-radius: 16px;
  text-align: center;
  min-width: 180px;
  box-shadow: 0 0 10px rgba(0,0,0,0.2);
  transition: 0.3s;
}
.card-stat:hover { transform: translateY(-4px); }
.card-stat h3 { margin: 5px 0; color: var(--accent); }
.todo-board {
  display: flex; flex-wrap: wrap; gap: 20px; justify-content: center;
}
.todo {
  background: var(--card-dark);
  backdrop-filter: var(--blur);
  border-radius: 16px;
  padding: 20px;
  width: 300px;
  box-shadow: 0 0 15px rgba(0,0,0,0.3);
  transition: 0.3s;
}
.todo.dragging {
  opacity: 0.5;
  transform: scale(1.05);
}
.todo-header {
  display: flex; justify-content: space-between; align-items: center;
  font-weight: 600; color: var(--accent);
}
.todo ul {
  list-style: none; padding: 0; margin: 10px 0 0;
}
.todo ul li {
  padding: 6px 0;
  display: flex; align-items: center;
  justify-content: space-between;
}
.todo ul li input[type="checkbox"] {
  transform: scale(1.2); margin-right: 8px;
}
.deadline {
  font-size: 12px; color: #aaa;
}
.fab {
  position: fixed; bottom: 30px; right: 30px;
  background: var(--accent);
  color: white;
  border: none;
  border-radius: 50%;
  width: 70px; height: 70px;
  font-size: 32px; cursor: pointer;
  box-shadow: 0 8px 25px rgba(0,0,0,0.3);
  backdrop-filter: var(--blur);
  transition: 0.3s;
}
.fab:hover { transform: scale(1.1); background: var(--accent-glow); }
.modal-bg {
  display: none; position: fixed; top:0; left:0; width:100%; height:100%;
  background: rgba(0,0,0,0.6); backdrop-filter: blur(6px);
  justify-content: center; align-items: center;
}
.modal {
  background: rgba(20,20,30,0.9);
  padding: 30px; border-radius: 16px; color: white;
  width: 90%; max-width: 400px; animation: fadeIn 0.3s ease;
}
.modal input, .modal textarea {
  width: 100%; padding: 10px; border-radius: 8px; border: none;
  margin-bottom: 10px;
}
.modal button {
  background: var(--accent); color: white; border: none;
  padding: 10px 16px; border-radius: 8px; cursor: pointer;
  width: 100%;
}
@keyframes fadeIn { from{opacity:0;transform:translateY(20px);} to{opacity:1;transform:translateY(0);} }
@media (max-width:768px){ .todo{width:90%;} }
</style>
</head>

<body>
<header>
  <h1>TodoTask Pro Enterprise</h1>
  <div class="controls">
    <button onclick="toggleTheme()">üåó ‡πÇ‡∏´‡∏°‡∏î</button>
    <button onclick="resetAll()">‚ôªÔ∏è ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
  </div>
</header>

<main>
  <div class="dashboard" id="summary">
    <div class="card-stat"><h3 id="total">0</h3><p>‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p></div>
    <div class="card-stat"><h3 id="done">0</h3><p>‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</p></div>
    <div class="card-stat"><h3 id="pending">0</h3><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à</p></div>
  </div>

  <div class="todo-board" id="todoBoard"></div>
</main>

<button class="fab" onclick="openModal()">Ôºã</button>

<!-- Modal -->
<div class="modal-bg" id="modalBg">
  <div class="modal">
    <h2>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h2>
    <input id="taskTitle" placeholder="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà">
    <textarea id="subTasks" placeholder="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏¢‡πà‡∏≠‡∏¢ (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢ , )"></textarea>
    <input type="date" id="deadline">
    <button onclick="addTask()">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
  </div>
</div>

<script>
let tasks = JSON.parse(localStorage.getItem("tasks")||"[]");
const board = document.getElementById("todoBoard");
const modal = document.getElementById("modalBg");

function openModal(){ modal.style.display="flex"; }
window.onclick = e => { if(e.target==modal) modal.style.display="none"; }

function save(){ localStorage.setItem("tasks",JSON.stringify(tasks)); update(); }

function addTask(){
  const title = document.getElementById("taskTitle").value.trim();
  const subs = document.getElementById("subTasks").value.split(",").map(s=>s.trim()).filter(Boolean);
  const deadline = document.getElementById("deadline").value;
  if(!title) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏•‡∏±‡∏Å‡∏Å‡πà‡∏≠‡∏ô");
  tasks.push({title, subs: subs.map(s=>({text:s,done:false})), done:false, deadline});
  document.getElementById("taskTitle").value="";
  document.getElementById("subTasks").value="";
  document.getElementById("deadline").value="";
  modal.style.display="none";
  save();
}

function toggleSub(ti, si){
  tasks[ti].subs[si].done = !tasks[ti].subs[si].done;
  tasks[ti].done = tasks[ti].subs.every(s=>s.done);
  save();
}

function deleteTask(i){
  if(confirm("‡∏•‡∏ö‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")){ tasks.splice(i,1); save(); }
}

function update(){
  board.innerHTML="";
  let total=0, done=0;
  tasks.forEach((t,i)=>{
    total++;
    if(t.done) done++;
    const card=document.createElement("div");
    card.className="todo"; card.draggable=true;
    const dline = t.deadline?`<div class='deadline'>‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î: ${t.deadline}</div>`:"";
    card.innerHTML=`
      <div class="todo-header">
        <span>${t.title}</span>
        <button onclick="deleteTask(${i})" style="background:none;border:none;color:#aaa;font-size:16px;cursor:pointer;">üóëÔ∏è</button>
      </div>
      ${dline}
      <ul>${t.subs.map((s,si)=>`
        <li><label><input type="checkbox" ${s.done?"checked":""} onchange="toggleSub(${i},${si})">${s.text}</label></li>
      `).join("")}</ul>
    `;
    card.addEventListener("dragstart",()=>{card.classList.add("dragging");});
    card.addEventListener("dragend",()=>{card.classList.remove("dragging"); saveOrder();});
    board.appendChild(card);
  });

  const draggingCard = ()=>document.querySelector(".dragging");
  board.addEventListener("dragover",e=>{
    e.preventDefault();
    const afterElement = getDragAfterElement(board,e.clientY);
    const drag = draggingCard();
    if(afterElement==null){board.appendChild(drag);} else {board.insertBefore(drag,afterElement);}
  });
  function getDragAfterElement(container, y){
    const els = [...container.querySelectorAll(".todo:not(.dragging)")];
    return els.reduce((closest,child)=>{
      const box = child.getBoundingClientRect();
      const offset = y - box.top - box.height/2;
      if(offset<0 && offset>closest.offset){ return {offset:offset,element:child}; }
      else return closest;
    },{offset:Number.NEGATIVE_INFINITY}).element;
  }

  document.getElementById("total").textContent = total;
  document.getElementById("done").textContent = done;
  document.getElementById("pending").textContent = total-done;
}

function saveOrder(){
  const order = [...document.querySelectorAll(".todo")].map((el,i)=>i);
  tasks = order.map((_,i)=>tasks[i]);
  save();
}

function resetAll(){
  if(confirm("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")){ tasks=[]; save(); }
}

function toggleTheme(){
  document.body.classList.toggle("light");
  if(document.body.classList.contains("light")){
    document.body.style.background= "var(--bg-light)";
    document.body.style.color= "var(--text-dark)";
  }else{
    document.body.style.background= "var(--bg-dark)";
    document.body.style.color= "var(--text-light)";
  }
}

update();
</script>
</body>
</html>
