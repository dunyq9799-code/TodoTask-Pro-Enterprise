<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£ | TodoTask Pro Enterprise</title>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
:root {
  --bg-dark: #0b0b15;
  --bg-light: #f7f7fa;
  --card-dark: rgba(255,255,255,0.08);
  --accent: #7a5af8;
  --text-light: #f5f5f5;
  --text-dark: #1b1b1b;
  --blur: blur(12px);
}
body {
  font-family: 'Sarabun', sans-serif;
  margin: 0; background: var(--bg-dark); color: var(--text-light);
  transition: background 0.5s, color 0.5s;
}
header {
  display: flex; justify-content: space-between; align-items: center;
  background: rgba(0,0,0,0.3); backdrop-filter: var(--blur);
  padding: 15px 30px; position: sticky; top: 0; z-index: 10;
}
header h2 { margin: 0; color: var(--accent); }
header button {
  background: rgba(255,255,255,0.15);
  border: none; border-radius: 10px;
  color: var(--text-light); padding: 10px 14px;
  cursor: pointer; transition: 0.3s;
  backdrop-filter: var(--blur);
}
header button:hover { background: rgba(122,90,248,0.4); }

main {
  max-width: 1100px; margin: 30px auto; padding: 20px;
}
.filter-bar {
  display: flex; justify-content: space-between; flex-wrap: wrap; gap: 10px;
  align-items: center; margin-bottom: 25px;
}
select {
  padding: 10px 16px; border-radius: 8px; border: none;
  backdrop-filter: var(--blur); background: rgba(255,255,255,0.1);
  color: var(--text-light); font-size: 15px;
}
button.download {
  background: var(--accent); color: white; border: none;
  padding: 10px 20px; border-radius: 10px;
  cursor: pointer; transition: 0.3s;
}
button.download:hover { background: rgba(122,90,248,0.6); }

.report-box {
  background: var(--card-dark);
  backdrop-filter: var(--blur);
  border-radius: 16px; padding: 20px;
  box-shadow: 0 0 15px rgba(0,0,0,0.3);
  margin-bottom: 30px;
}
h3 { color: var(--accent); margin-top: 0; }

table {
  width: 100%; border-collapse: collapse; margin-top: 15px;
}
th, td {
  padding: 10px 12px; text-align: left;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}
th { color: var(--accent); }

.back-btn {
  background: rgba(255,255,255,0.1);
  border: none; color: var(--text-light);
  border-radius: 50%; width: 45px; height: 45px;
  font-size: 20px; cursor: pointer;
  backdrop-filter: var(--blur);
  margin-right: 10px;
}
.back-btn:hover { background: rgba(122,90,248,0.4); }

@media (max-width: 768px) {
  .filter-bar { flex-direction: column; align-items: stretch; }
}
</style>
</head>

<body>
<header>
  <div style="display:flex;align-items:center;">
    <button class="back-btn" onclick="history.back()">‚Üê</button>
    <h2>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£</h2>
  </div>
  <div>
    <button onclick="toggleTheme()">üåó</button>
  </div>
</header>

<main id="reportArea">
  <div class="filter-bar">
    <div>
      <select id="monthSelect" onchange="loadReport()">
        <option value="01">‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°</option>
        <option value="02">‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå</option>
        <option value="03">‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°</option>
        <option value="04">‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô</option>
        <option value="05">‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°</option>
        <option value="06">‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô</option>
        <option value="07">‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°</option>
        <option value="08">‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°</option>
        <option value="09">‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô</option>
        <option value="10">‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°</option>
        <option value="11" selected>‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô</option>
        <option value="12">‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°</option>
      </select>
      <select id="teamSelect" onchange="loadReport()">
        <option value="all">‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡∏°</option>
        <option value="A">‡∏ó‡∏µ‡∏° A</option>
        <option value="B">‡∏ó‡∏µ‡∏° B</option>
        <option value="C">‡∏ó‡∏µ‡∏° C</option>
      </select>
    </div>
    <button class="download" onclick="downloadPDF()">üìÑ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF</button>
  </div>

  <div class="report-box">
    <h3>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏£‡∏ß‡∏°‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£</h3>
    <canvas id="donutChart"></canvas>
  </div>

  <div class="report-box">
    <h3>üìà ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ó‡∏µ‡∏°</h3>
    <canvas id="barChart"></canvas>
  </div>

  <div class="report-box">
    <h3>üìã ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏£‡∏ß‡∏°</h3>
    <table id="reportTable">
      <thead>
        <tr>
          <th>‡∏ó‡∏µ‡∏°</th>
          <th>‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</th>
          <th>‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</th>
          <th>‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà</th>
          <th>‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</main>

<script>
let donutChart, barChart;

function toggleTheme(){
  document.body.classList.toggle("light");
  if(document.body.classList.contains("light")){
    document.body.style.background="var(--bg-light)";
    document.body.style.color="var(--text-dark)";
  } else {
    document.body.style.background="var(--bg-dark)";
    document.body.style.color="var(--text-light)";
  }
}

function loadReport(){
  const team = document.getElementById("teamSelect").value;
  const mock = {
    A: { total: 30, done: 25 },
    B: { total: 25, done: 18 },
    C: { total: 28, done: 24 }
  };
  let filtered = team==="all" ? mock : { [team]: mock[team] };
  renderCharts(filtered);
  renderTable(filtered);
}

function renderCharts(data){
  const labels = Object.keys(data);
  const done = labels.map(t => data[t].done);
  const total = labels.map(t => data[t].total);
  const pending = labels.map(t => data[t].total - data[t].done);

  if(donutChart) donutChart.destroy();
  if(barChart) barChart.destroy();

  const sumDone = done.reduce((a,b)=>a+b,0);
  const sumPending = pending.reduce((a,b)=>a+b,0);
  donutChart = new Chart(document.getElementById("donutChart"), {
    type: "doughnut",
    data: {
      labels: ["‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß", "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à"],
      datasets: [{
        data: [sumDone, sumPending],
        backgroundColor: ["#7a5af8","#ccc"]
      }]
    },
    options: { plugins:{legend:{position:"bottom"}}, cutout:"70%" }
  });

  barChart = new Chart(document.getElementById("barChart"), {
    type: "bar",
    data: {
      labels: labels.map(t=>"‡∏ó‡∏µ‡∏° "+t),
      datasets: [{
        label: "‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
        data: labels.map(t => Math.round((data[t].done/data[t].total)*100)),
        backgroundColor: "#7a5af8"
      }]
    },
    options: { scales:{y:{beginAtZero:true,max:100}} }
  });
}

function renderTable(data){
  const tbody = document.querySelector("#reportTable tbody");
  tbody.innerHTML="";
  Object.entries(data).forEach(([team,info])=>{
    const pending = info.total-info.done;
    const percent = Math.round((info.done/info.total)*100);
    const tr = document.createElement("tr");
    tr.innerHTML=`
      <td>‡∏ó‡∏µ‡∏° ${team}</td>
      <td>${info.total}</td>
      <td>${info.done}</td>
      <td>${pending}</td>
      <td>${percent}%</td>`;
    tbody.appendChild(tr);
  });
}

function downloadPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.text("‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£ - TodoTask Pro Enterprise", 10, 10);
  doc.text("‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: "+new Date().toLocaleDateString("th-TH"), 10, 20);
  doc.html(document.getElementById("reportArea"), {
    callback: function(doc){ doc.save("report.pdf"); },
    x: 10, y: 30, width: 180
  });
}

loadReport();
</script>
</body>
</html>
