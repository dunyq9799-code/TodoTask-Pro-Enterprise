<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Settings | Task Management System</title>
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet" />
<style>
*{box-sizing:border-box;transition:all 0.3s ease;font-family:"Kanit",sans-serif;}
:root{
 --violet:#715aff;
 --bg-light:#f4f4f7;
 --bg-dark:#0d0d12;
 --card-light:#fff;
 --card-dark:#1a1a24;
 --text-light:#0d0d12;
 --text-dark:#f4f4f7;
}
body{
 margin:0;
 background:var(--bg-light);
 color:var(--text-light);
 min-height:100vh;
 display:flex;
 flex-direction:column;
}
body.dark{
 background:var(--bg-dark);
 color:var(--text-dark);
}
header{
 display:flex;
 justify-content:space-between;
 align-items:center;
 background:var(--card-light);
 box-shadow:0 0 8px rgba(0,0,0,.15);
 padding:10px 20px;
}
body.dark header{background:var(--card-dark);}
header h1{color:var(--violet);margin:0;}
#toggleMode{background:none;border:none;font-size:22px;cursor:pointer;color:inherit;}
#backBtn{background:var(--violet);color:#fff;border:none;padding:8px 16px;border-radius:8px;cursor:pointer;}
main{flex:1;padding:20px;display:flex;flex-direction:column;align-items:center;}
.section{width:100%;max-width:800px;margin-bottom:30px;}
.card{
 background:var(--card-light);
 padding:20px;
 border-radius:12px;
 box-shadow:0 4px 8px rgba(0,0,0,.1);
 margin-bottom:20px;
}
body.dark .card{background:var(--card-dark);}
h2{color:var(--violet);margin-top:0;}
button.primary{
 background:var(--violet);
 color:#fff;
 border:none;
 padding:10px 16px;
 border-radius:8px;
 cursor:pointer;
 margin:5px 5px 0 0;
}
input,select{
 width:100%;
 padding:8px;
 margin:5px 0;
 border-radius:8px;
 border:1px solid #ccc;
}
label{font-weight:600;}
.toast{
 position:fixed;
 bottom:20px;
 right:20px;
 background:#333;
 color:#fff;
 padding:10px 16px;
 border-radius:8px;
 opacity:0;
 transition:opacity .3s;
 z-index:9999;
}
.toast.show{opacity:1;}
.modal{
 position:fixed;
 top:0;left:0;width:100%;height:100%;
 background:rgba(0,0,0,0.5);
 display:none;
 justify-content:center;
 align-items:center;
 z-index:1000;
}
.modal-content{
 background:var(--card-light);
 padding:20px;
 border-radius:12px;
 width:90%;
 max-width:400px;
}
body.dark .modal-content{background:var(--card-dark);}
.modal-content h3{margin-top:0;color:var(--violet);}
.modal-content input{margin-bottom:10px;}
</style>
</head>
<body>
<header>
 <h1>Settings</h1>
 <div>
   <button id="toggleMode">üåô</button>
   <span id="userName" style="margin:0 10px;font-weight:600;"></span>
   <button id="backBtn">‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà Dashboard</button>
 </div>
</header>

<main>
 <!-- Account Settings -->
 <section class="section" id="accountSettings">
   <h2>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Account Settings)</h2>
   <div class="card">
     <p><b>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏°:</b> <span id="displayName">-</span></p>
     <p><b>‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</b> <span id="displayEmail">-</span></p>
     <p><b>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</b> <span id="displayCreated">-</span></p>
     <p><b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</b> <span id="emailStatus">-</span></p>
     <div>
       <button id="editNameBtn" class="primary">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</button>
       <button id="changePassBtn" class="primary">üîë ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</button>
       <button id="verifyEmailBtn" class="primary">üì© ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
       <button id="deleteAccBtn" class="primary" style="background:crimson;">‚ùå ‡∏•‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</button>
     </div>
   </div>
 </section>

 <!-- System Preferences -->
 <section class="section" id="systemSettings">
   <h2>‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö (System Preferences)</h2>
   <div class="card">
     <label>üîî ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:</label>
     <select id="notifSelect">
       <option value="on">‡πÄ‡∏õ‡∏¥‡∏î</option>
       <option value="off">‡∏õ‡∏¥‡∏î</option>
     </select>
     <label>üé® ‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏µ:</label>
     <select id="themeSelect">
       <option value="light">‡∏™‡∏ß‡πà‡∏≤‡∏á</option>
       <option value="dark">‡∏°‡∏∑‡∏î</option>
     </select>
     <label>üåê ‡∏†‡∏≤‡∏©‡∏≤:</label>
     <select id="langSelect">
       <option value="th">‡πÑ‡∏ó‡∏¢</option>
       <option value="en">English</option>
     </select>
     <button id="savePref" class="primary">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
     <button id="resetPref" class="primary" style="background:gray;">üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
   </div>
 </section>
</main>

<!-- Modal Edit -->
<div class="modal" id="editModal">
  <div class="modal-content">
    <h3>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
    <input type="text" id="newName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà...">
    <button id="saveName" class="primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    <button id="cancelEdit" class="primary" style="background:gray;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, onAuthStateChanged, updatePassword, sendEmailVerification, deleteUser } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig={
  apiKey:"AIzaSyB_7tyj_BAyFzKEYVrZXfQjWCUXGS7VqKY",
  authDomain:"my-todo-list-9d2fa.firebaseapp.com",
  projectId:"my-todo-list-9d2fa",
  storageBucket:"my-todo-list-9d2fa.appspot.com",
  messagingSenderId:"631403892452",
  appId:"1:631403892452:web:66d382bf5f143fc05de6f1"
};
const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

const toast=document.getElementById("toast");
function showToast(msg,color="#333"){
 toast.textContent=msg;
 toast.style.background=color;
 toast.classList.add("show");
 setTimeout(()=>toast.classList.remove("show"),3000);
}

// Theme toggle
const body=document.body;
const toggle=document.getElementById("toggleMode");
if(localStorage.getItem("theme")==="dark"){body.classList.add("dark");toggle.textContent="‚òÄÔ∏è";}
toggle.onclick=()=>{
 body.classList.toggle("dark");
 toggle.textContent=body.classList.contains("dark")?"‚òÄÔ∏è":"üåô";
 localStorage.setItem("theme",body.classList.contains("dark")?"dark":"light");
};

// Auth
onAuthStateChanged(auth,async user=>{
 if(!user){window.location.href="login.html";return;}
 const uid=user.uid;
 const userRef=doc(db,"users",uid);
 const snap=await getDoc(userRef);
 if(!snap.exists()){showToast("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ","crimson");return;}
 const data=snap.data();
 if(data.role==="admin"){window.location.href="admin.html";return;}
 document.getElementById("userName").textContent=data.name||user.email;
 document.getElementById("displayName").textContent=data.name||"-";
 document.getElementById("displayEmail").textContent=user.email;
 document.getElementById("displayCreated").textContent=user.metadata.creationTime;
 document.getElementById("emailStatus").textContent=user.emailVerified?"‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß":"‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô";
});

// Buttons
document.getElementById("backBtn").onclick=()=>window.location.href="index.html";

// Edit name modal
const modal=document.getElementById("editModal");
document.getElementById("editNameBtn").onclick=()=>modal.style.display="flex";
document.getElementById("cancelEdit").onclick=()=>modal.style.display="none";
document.getElementById("saveName").onclick=async()=>{
 const newName=document.getElementById("newName").value.trim();
 if(!newName){showToast("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà","orange");return;}
 const user=auth.currentUser;
 await updateDoc(doc(db,"users",user.uid),{name:newName});
 showToast("‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","green");
 document.getElementById("displayName").textContent=newName;
 modal.style.display="none";
};

// Change password
document.getElementById("changePassBtn").onclick=async()=>{
 const newPass=prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà:");
 if(!newPass){showToast("‚ö†Ô∏è ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô","orange");return;}
 try{await updatePassword(auth.currentUser,newPass);showToast("‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","green");}
 catch(e){showToast("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ","crimson");}
};

// Verify email
document.getElementById("verifyEmailBtn").onclick=async()=>{
 const user=auth.currentUser;
 if(user.emailVerified){showToast("‚úÖ ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß","green");return;}
 await sendEmailVerification(user);
 showToast("üì© ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß","green");
};

// Delete account
document.getElementById("deleteAccBtn").onclick=async()=>{
 if(!confirm("‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?"))return;
 try{
   await deleteUser(auth.currentUser);
   showToast("‚ùå ‡∏•‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢","crimson");
   window.location.href="login.html";
 }catch(e){showToast("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÑ‡∏î‡πâ","crimson");}
};

// Preferences
document.getElementById("savePref").onclick=()=>{
 const notif=document.getElementById("notifSelect").value;
 const theme=document.getElementById("themeSelect").value;
 const lang=document.getElementById("langSelect").value;
 localStorage.setItem("notif",notif);
 localStorage.setItem("themePref",theme);
 localStorage.setItem("lang",lang);
 showToast("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢","green");
};
document.getElementById("resetPref").onclick=()=>{
 localStorage.clear();
 showToast("üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß","orange");
 location.reload();
};

// Load saved preferences
window.onload=()=>{
 const notif=localStorage.getItem("notif")||"on";
 const theme=localStorage.getItem("themePref")||"light";
 const lang=localStorage.getItem("lang")||"th";
 document.getElementById("notifSelect").value=notif;
 document.getElementById("themeSelect").value=theme;
 document.getElementById("langSelect").value=lang;
};
</script>
</body>
</html>
